name: Shell Script Validation

on:
  push:
    paths:
      - '**/*.sh'
      - '.shellcheckrc'
      - '.github/workflows/shellcheck.yml'
  pull_request:
    paths:
      - '**/*.sh'
      - '.shellcheckrc'
      - '.github/workflows/shellcheck.yml'

jobs:
  freeze_guard:
    uses: ./.github/workflows/freeze-guard.yml
    secrets: inherit

  workflow-lint:
    uses: ./.github/workflows/workflow-lint.yml
    secrets: inherit

  shellcheck:
    name: Validate Shell Scripts
    runs-on: ubuntu-latest
    needs: [freeze_guard, workflow-lint]
    if: ${{ needs.freeze_guard.outputs.active != 'true' }}
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Install shellcheck
        run: |
          sudo apt-get update
          sudo apt-get install -y shellcheck
      
      - name: Validate scripts
        run: |
          bash scripts/validate.sh
      
      - name: Check script permissions
        run: |
          # Check if all .sh files are executable
          non_executable=$(find scripts -name "*.sh" -type f ! -executable)
          if [ -n "$non_executable" ]; then
            echo "The following scripts are not executable:"
            echo "$non_executable"
            exit 1
          fi
