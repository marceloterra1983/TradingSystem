#!/usr/bin/env bash

set -eu

if [ "${SKIP_DOCS_HOOKS:-0}" = "1" ]; then
  echo "‚ö†Ô∏è  Skipping docs lint (SKIP_DOCS_HOOKS=1)"
  exit 0
fi

if [ "${SKIP_DOCS_AUTO:-0}" = "1" ]; then
  echo "‚ö†Ô∏è  Skipping docs:auto (SKIP_DOCS_AUTO=1)"
else
  echo "üîÑ docs auto-generate"
  npm --prefix docs run docs:auto
  
  # Adicionar automaticamente arquivos gerados pelo docs:auto
  if [ -f "docs/content/frontend/design-system/tokens.mdx" ]; then
    git add docs/content/frontend/design-system/tokens.mdx
  fi
  if [ -f "docs/content/reference/ports.mdx" ]; then
    git add docs/content/reference/ports.mdx
  fi
  
  echo "‚úì Auto-generated files added to staging"
fi

echo "üîç docs lint"
npm --prefix docs run docs:lint || echo "‚ö†Ô∏è  Lint errors found but not blocking commit"

echo "‚úÖ Pre-commit validation passed"
echo "‚ÑπÔ∏è  Note: Run 'bash scripts/maintenance/validate-md-structure.sh' manually if needed"
