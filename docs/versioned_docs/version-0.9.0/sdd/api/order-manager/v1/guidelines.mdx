---
title: API Guidelines
description: Naming, error handling, and idempotency guidelines for Order Manager
  API v1.
tags:
  - sdd
  - order-manager
  - api
owner: ArchitectureGuild
lastReviewed: '2025-10-26'
---
## Guidelines

Document naming conventions, error response models, idempotency expectations, validation rules, rate limiting, security, versioning, documentation requirements, and testing guidelines for Order Manager API v1.

## Naming Conventions

### Endpoints

- Use plural nouns for collections (`/api/orders`, `/api/positions`)
- Use `{resourceId}` for single resources (`/api/orders/{orderId}`)
- Prefer HTTP verbs over verbs in the path (POST `/api/orders`, DELETE `/api/orders/{orderId}`)
- Model sub-resources under the parent (`/api/orders/{orderId}/fills`)
- For non-CRUD actions apply verb suffixes (`/api/risk/kill-switch`)

### Fields

- JSON keys in camelCase (`orderId`, `avgFillPrice`)
- Enums in UPPER_SNAKE_CASE (`PARTIALLY_FILLED`, `KILL_SWITCH`)
- Timestamps in ISO 8601 with timezone (`2025-10-24T10:30:00Z`)
- Prices as decimals with two places (32.50)
- Quantities as integers (100)

### HTTP Methods

- `GET`: Retrieve resources (idempotent, cacheable)
- `POST`: Create resources or trigger actions (non-idempotent unless key supplied)
- `PUT`: Replace entire resource (idempotent)
- `PATCH`: Partial update (idempotent)
- `DELETE`: Remove resource or toggle state (idempotent)

## Error Response Models

### Success Envelope

```json
{
  "success": true,
  "data": {},
  "message": "optional success message"
}
```

### Error Envelope

```json
{
  "success": false,
  "error": "Validation failed",
  "errors": [
    "Field quantity must be positive"
  ]
}
```

### Status Codes

| Code | Usage | Example |
| ---- | ----- | ------- |
| 200 | Successful GET/PUT/DELETE | Order retrieved |
| 201 | Successful create | Order created |
| 204 | Optional for DELETE with no body | Order canceled (no payload) |
| 400 | Validation failure | Invalid symbol |
| 403 | Business rule or risk violation | Daily loss limit exceeded |
| 404 | Resource missing | Order ID not found |
| 429 | Rate limit exceeded | 300 req/60s exceeded |
| 500 | Unexpected failure | ProfitDLL connection lost |
| 503 | Downstream dependency unavailable | Database offline |

### Error Categories

- Validation errors (400): Missing fields, invalid enums, out-of-range values
- Business logic errors (403): Risk failures, trading hours violation, kill switch active
- Resource errors (404): Order or symbol not found
- System errors (500/503): ProfitDLL failure, database unavailable, unhandled exceptions

### Error Message Guidance

- Provide actionable, human-readable language
- Reference the offending field for validation errors
- Avoid internal implementation details or stack traces
- Log detailed context server-side while returning sanitized messages

## Idempotency Expectations

### POST /api/orders

- `idempotencyKey` optional but recommended (UUID v4)
- If provided and seen within 24 hours return existing order (200 OK)
- Without key create new order, risking duplicates on retries

### DELETE `/api/orders/{orderId}`

- Idempotent by design
- Repeated cancels return success with current status
- Reject cancel for filled orders with 400 Bad Request

### POST /api/risk/kill-switch

- Idempotent activation
- Repeated calls return current kill-switch state and zero additional cancellations

### PUT /api/risk/limits

- Last-write-wins semantics
- Future enhancement: optimistic locking with version field

## Validation Rules

### Order Creation

- Required fields: `symbol`, `side`, `type`, `quantity`
- Conditional fields: `price` for LIMIT/STOP_LIMIT, `stopPrice` for STOP/STOP_LIMIT
- Optional fields: `timeInForce` (default DAY), `idempotencyKey`
- Symbol must exist in market data catalog
- Quantity positive integer, respect lot size, ≤ max position size
- Price positive decimal, ≤ ±10% from last trade (circuit breaker)
- Stop price relations: BUY stop price ≥ limit price, SELL stop price ≤ limit price
- Business checks: trading hours, daily loss limit, margin sufficiency, kill switch inactive

### Order Cancellation

- Order must exist
- Allowed statuses: PENDING, SUBMITTED, PARTIALLY_FILLED
- Prevent cancel of FILLED orders (400)

### Risk Limit Updates

- `dailyLossLimit`: Positive number (100–1_000_000 BRL)
- `maxPositionSize`: Map of symbol → positive integer
- `tradingHours`: Valid HH:MM 24h format, start < end

## Rate Limiting

- Global quota: 300 requests per 60 seconds per client (planned)
- Endpoint caps:
  - POST `/api/orders`: 100 req/60s
  - DELETE `/api/orders/{id}`: 100 req/60s
  - POST `/api/risk/kill-switch`: 10 req/60s
  - GET `/api/orders`: 300 req/60s
  - GET `/health`: 300 req/15min
- Include rate limit headers (`RateLimit-Limit`, `RateLimit-Remaining`, `RateLimit-Reset`)
- 429 response payload:

```json
{
  "success": false,
  "error": "Rate limit exceeded",
  "retryAfter": 45
}
```

## Security Guidelines

- MVP: Internal network only, no authentication, HTTP
- Planned: JWT bearer authentication, role-based authorization (trader, admin, read-only)
- Enforce TLS via reverse proxy once exposed
- Rotate API keys / credentials every 90 days
- Sanitize logs: mask sensitive prices/quantities, omit tokens
- Validate and sanitize all user inputs to avoid injection attacks

## Versioning Strategy

- MVP operates without explicit version prefix (`/api/orders`)
- Breaking changes trigger `/api/v1` adoption, with six-month overlap period
- Breaking changes include removing fields, changing types, altering enums, or status semantics
- Non-breaking changes include adding optional fields/endpoints
- Communicate deprecations via headers and changelog entries

## Documentation Requirements

- Maintain OpenAPI spec at `backend/api/order-manager.openapi.yaml` (TODO)
- Synchronize updates with frontend consumers (e.g., `frontend/api/README.md`)
- Record all changes in `sdd/api/order-manager/v1/changelog.mdx`
- Provide request/response examples for each endpoint
- Maintain error catalog covering status codes and sample payloads

## Testing Guidelines

- Unit tests: validation logic, error envelopes, idempotency key handling
- Integration tests: ProfitDLL connectivity, risk check pipeline, order lifecycle
- Load tests: confirm &lt;500 ms p95 order placement, verify rate limiting, exercise 100 concurrent orders
- Regression tests: kill switch activation, partial fill timeouts, ProfitDLL disconnect recovery

## Validation with ArchitectureGuild

- ✅ Naming conventions approved
- ✅ Error response models approved
- ✅ Idempotency expectations confirmed
- ✅ Validation rules reviewed
- ✅ Rate limiting plan endorsed
