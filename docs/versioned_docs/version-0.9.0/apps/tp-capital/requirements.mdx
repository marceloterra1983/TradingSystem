---
title: Functional Requirements
sidebar_position: 3
description: Functional and non-functional requirements for the TP Capital application.
tags:
  - apps
  - tp-capital
  - requirements
owner: DocsOps
lastReviewed: '2025-10-26'
---
## Functional Requirements

### FR-1: Telegram Bot Listener

- Support Telegram Gateway ingestion (database queue) with optional bot polling fallback.
- Handle multiple Telegram channels and bots.
- Store bot metadata in TimescaleDB (`tp_capital.telegram_bots`, `tp_capital.telegram_channels`).
- Endpoints: `GET /telegram/bots`, `GET /telegram/channels`, CRUD operations for maintenance.

### FR-2: Message Parser

- Extract structured data from Telegram messages:
  - Asset symbol (e.g., PETR4, VALE3)
  - Signal type (COMPRA, VENDA)
  - Buy range (min/max prices)
  - Target prices (array of targets)
  - Stop loss price
  - Channel source
  - Timestamp
- Validate payload structure before persistence.
- Handle malformed messages gracefully (log errors, skip invalid).

### FR-3: Timescale Writer

- Persist normalized signals to `tp_capital.tp_capital_signals`.
- Enforce idempotency for `(channel_id, message_id)` combinations.
- Manage hypertable creation and retention policies.
- Provide healthcheck that reports Timescale connectivity.

### FR-4: REST API Endpoints

- `GET /signals` - Paginated list of signals with filters (channel, signal_type, limit, offset).
- `GET /logs` - Operational logs from ingestion process.
- `GET /telegram/bots` - Registered bot metadata.
- `GET /telegram/channels` - Monitored channels and groups.
- All endpoints return JSON responses.

### FR-5: Prometheus Metrics

- Expose `/metrics` endpoint for Prometheus scraping.
- Track ingestion rate, error rate, latency percentiles.

### FR-6: Sample Data Seeding

- Provide `npm run seed` command to populate TimescaleDB with synthetic signals.
- Support local QA and testing workflows.

## Non-Functional Requirements

### NFR-1: Performance

- **Ingestion latency**: &lt;500ms p95 (Telegram Gateway write â†’ Timescale commit).
- **API response time**: &lt;200ms p95 for `/signals` queries.
- **Throughput**: Support 100+ signals/minute during peak hours.

### NFR-2: Reliability

- **Availability**: 99.5% uptime (excluding planned maintenance).
- **Data durability**: TimescaleDB persistence via Docker volume (`tp-capital-timescaledb-data`).
- **Error handling**: Graceful degradation if TimescaleDB unavailable (log errors, retry with backoff, keep Gateway queue intact).

### NFR-3: Auditability

- Structured logs to stdout using shared logger (`logger.js`).
- TimescaleDB acts as audit log (all signals timestamped and immutable).
- Operational logs accessible via `GET /logs` endpoint.

### NFR-4: Security

- Telegram bot tokens stored in centralized `.env` (never hardcoded).
- Validate environment variables on startup (`scripts/env/validate-env.sh`).
- No sensitive data in logs or error messages.

### NFR-5: Scalability

- Stateless service design (horizontal scaling possible).
- TimescaleDB handles high-volume time-series data efficiently.
- Month-partitioned hypertables support pruning and archival.

### NFR-6: Maintainability

- TypeScript interfaces for Signal schema.
- Shared logger and metrics middleware.
- Comprehensive integration examples in documentation.
