---
title: Configuration
sidebar_position: 5
description: Environment variables, secrets, and runtime configuration for the Telegram Gateway services.
tags:
  - apps
  - telegram-gateway
  - configuration
owner: DocsOps
lastReviewed: '2025-10-26'
---
## Overview

Telegram Gateway is split into two deployables:

- **Gateway Service (`apps/telegram-gateway`)** – runs locally, manages MTProto sessions, listens to channels, and publishes messages to TimescaleDB/HTTP targets.
- **Gateway REST API (`backend/api/telegram-gateway`)** – containerized Express service exposing stored messages and operational data.

Both services load the repository root `.env`, optional `.env.local`, and their own local `.env` files.

Run `scripts/env/validate-env.sh` whenever variables change.

## Gateway Service (`apps/telegram-gateway`)

### Required Variables

| Variable | Description | Example |
|----------|-------------|---------|
| `GATEWAY_PORT` | HTTP port for health/metrics endpoints | `4006` |
| `TELEGRAM_API_ID` | Telegram API ID from my.telegram.org | `123456` |
| `TELEGRAM_API_HASH` | Telegram API hash | `abc123def456` |
| `TELEGRAM_PHONE_NUMBER` | Phone number linked to the Telegram account | `+5511999999999` |
| `API_ENDPOINTS` | Comma-separated list of target ingest URLs | `http://localhost:4005/ingest` |
| `API_SECRET_TOKEN` | Shared secret sent via `X-Gateway-Token` header | `super_secret_token` |

### Optional Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `TELEGRAM_BOT_TOKEN` | Bot token (used for dual-mode forwarding) | _empty_ |
| `TELEGRAM_SOURCE_CHANNEL_IDS` | CSV of source channels (`-100...`) | _empty_ |
| `TELEGRAM_DESTINATION_CHANNEL_ID` | Channel for forwarding | _empty_ |
| `TELEGRAM_MODE` | `polling` or `webhook` | `polling` |
| `MAX_RETRIES` | Forward retry attempts | `3` |
| `BASE_RETRY_DELAY_MS` | Initial retry delay | `5000` |
| `FAILURE_QUEUE_PATH` | Path to JSONL queue for failed publishes | `./data/failure-queue.jsonl` |
| `LOG_LEVEL` | `debug`, `info`, `warn`, `error` | `info` |

### Database Settings

| Variable | Description | Default |
|----------|-------------|---------|
| `TELEGRAM_GATEWAY_DB_URL` | Full PostgreSQL/Timescale connection string | _derived from defaults_ |
| `TELEGRAM_GATEWAY_DB_SCHEMA` | Schema for queue tables | `telegram_gateway` |
| `TELEGRAM_GATEWAY_DB_HOST` / `PORT` | Overrides for DB host/port | inherits from Timescale defaults |
| `TELEGRAM_GATEWAY_DB_USER` | Database user | `timescale` |
| `TELEGRAM_GATEWAY_DB_PASSWORD` | Database password | `pass_timescale` |

If `TELEGRAM_GATEWAY_DB_URL` is omitted, the service falls back to TimescaleDB values defined globally (`TIMESCALEDB_*`).

## REST API (`backend/api/telegram-gateway`)

### Required Variables

| Variable | Description | Example |
|----------|-------------|---------|
| `TELEGRAM_GATEWAY_API_PORT` | API port (default 4010) | `4010` |
| `TELEGRAM_GATEWAY_API_TOKEN` | Token expected in `X-Gateway-Token` header | `gw_secret_9K7j2mPq` |
| `TELEGRAM_GATEWAY_DB_URL` | Connection string to queue database | `postgresql://timescale:pass_timescale@localhost:5433/APPS-TPCAPITAL?schema=telegram_gateway` |

### Optional Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `TELEGRAM_GATEWAY_DB_SCHEMA` | Schema name | `telegram_gateway` |
| `TELEGRAM_GATEWAY_DEFAULT_PAGE_SIZE` | Default pagination size | `50` |
| `TELEGRAM_GATEWAY_MAX_PAGE_SIZE` | Max pagination size | `200` |
| `LOG_LEVEL` | Logging level | `info` |

## Port Map

| Service | Port | Description |
|---------|------|-------------|
| Gateway Service | 4006 | Health/metrics, local management |
| Gateway REST API | 4010 | REST endpoints (`/api/messages`, `/api/channels`) |
| TimescaleDB | 5433 (host) / 5432 (container) | Queue + TP Capital storage |

> Gateway service runs locally (not containerized) to keep Telegram session files on disk. REST API is container-friendly and can be supervised alongside TP Capital.

## Security & Secrets

- Store `.session/` directory securely (permissions `0600`); never commit to Git.
- Rotate `API_SECRET_TOKEN`, `TELEGRAM_GATEWAY_API_TOKEN`, and Telegram credentials quarterly.
- Use password vaults or secret stores for production deployments instead of plaintext `.env`.
- Failure queue JSONL may contain raw Telegram content—treat as sensitive.

## Validation

1. Run Gateway locally: `npm install && npm start` (responds on `http://localhost:4006/health`).
2. Run REST API: `npm install && npm run dev` inside `backend/api/telegram-gateway`.
3. Execute `./scripts/init-database.sh` (REST API) to ensure schema matches expectation.
4. Verify end-to-end by hitting `http://localhost:4010/api/messages?limit=5` and checking message flow into TP Capital.
