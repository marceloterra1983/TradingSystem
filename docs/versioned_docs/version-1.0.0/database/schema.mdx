---
title: Schema Reference
description: Entity relationships and schema details for TradingSystem databases.
tags:
  - database
  - schema
owner: DataOps
lastReviewed: '2025-10-27'
---
## Overview

TradingSystem operates with production-grade schemas across multiple database systems. TimescaleDB powers TP Capital and Workspace services with hypertables, PostgreSQL + Prisma manages Documentation API with type-safe migrations, QuestDB handles time-series telemetry, and LowDB remains for legacy Idea Bank.

**Active Databases**:

- **APPS-TPCAPITAL** (TimescaleDB) – TP Capital trading signals with `tp-capital` schema
- **APPS-WORKSPACE** (TimescaleDB) – Workspace items with `workspace` schema and audit logging
- **documentation-api** (PostgreSQL + Prisma) – Documentation systems, ideas, files, and audit log
- **QuestDB** – Time-series TP Capital signals and Telegram metadata
- **LowDB** – Legacy Idea Bank JSON storage (migration pending)

## ER Diagram

**Current State**: Entity relationships exist within each database domain.

**APPS-WORKSPACE relationships**:

```
workspace_items (1) ----< (N) workspace_audit_log
```

**documentation-api relationships**:

```
documentation_systems (1) ----< (N) documentation_ideas
documentation_systems (1) ----< (N) documentation_files
documentation_ideas (1) ----< (N) documentation_files
```

**Next Steps**: Generate comprehensive ER diagrams via PlantUML or dbdiagram.io.

## TimescaleDB Schemas

### APPS-TPCAPITAL Database

**Database**: `APPS-TPCAPITAL`  
**Schema**: `tp-capital`  
**Port**: 5433  
**Connection**: `postgresql://timescale@localhost:5433/APPS-TPCAPITAL`

#### tp_capital_signals (Hypertable)

Trading signals migrated from QuestDB to TimescaleDB for improved query performance.

| Column | Type | Description | Constraints |
|--------|------|-------------|-------------|
| `id` | UUID | Primary key | NOT NULL, DEFAULT gen_random_uuid() |
| `channel` | VARCHAR(100) | Source channel label | |
| `signal_type` | VARCHAR(50) | Operation type | |
| `asset` | VARCHAR(50) | Asset ticker | |
| `entry_price` | DECIMAL(18,8) | Entry price | |
| `stop_loss` | DECIMAL(18,8) | Stop loss price | |
| `take_profit` | DECIMAL(18,8) | Take profit target | |
| `raw_message` | TEXT | Original Telegram message | |
| `created_at` | TIMESTAMPTZ | Signal timestamp | NOT NULL, DEFAULT NOW() |
| `updated_at` | TIMESTAMPTZ | Last update | NOT NULL, DEFAULT NOW() |

```sql
-- Hypertable with daily partitioning
SELECT create_hypertable('tp-capital.tp_capital_signals', 'created_at', 
  chunk_time_interval => INTERVAL '1 day');
```

**Indexes**:

- Primary key on `id`
- Time-series index on `created_at DESC`
- Filter indexes on `channel`, `asset`, `signal_type`

#### telegram_bots

Bot configuration for Telegram integration.

| Column | Type | Description | Constraints |
|--------|------|-------------|-------------|
| `id` | UUID | Primary key | NOT NULL, DEFAULT gen_random_uuid() |
| `username` | VARCHAR(255) | Bot username | |
| `token` | TEXT | Bot API token | NOT NULL |
| `bot_type` | VARCHAR(50) | Bot type | |
| `status` | VARCHAR(20) | Active status | DEFAULT 'active' |
| `created_at` | TIMESTAMPTZ | Creation timestamp | NOT NULL, DEFAULT NOW() |
| `updated_at` | TIMESTAMPTZ | Last update | NOT NULL, DEFAULT NOW() |

#### telegram_channels

Monitored Telegram channels configuration.

| Column | Type | Description | Constraints |
|--------|------|-------------|-------------|
| `id` | UUID | Primary key | NOT NULL, DEFAULT gen_random_uuid() |
| `label` | VARCHAR(255) | Channel label | |
| `channel_id` | BIGINT | Telegram channel ID | |
| `channel_type` | VARCHAR(50) | Channel type | |
| `status` | VARCHAR(20) | Active status | DEFAULT 'active' |
| `created_at` | TIMESTAMPTZ | Creation timestamp | NOT NULL, DEFAULT NOW() |
| `updated_at` | TIMESTAMPTZ | Last update | NOT NULL, DEFAULT NOW() |

---

### APPS-WORKSPACE Database

**Database**: `APPS-WORKSPACE`  
**Schema**: `workspace`  
**Port**: 5433  
**Connection**: `postgresql://timescale@localhost:5433/APPS-WORKSPACE`

#### workspace_items (Hypertable)

Workspace items with time-series capabilities and monthly partitioning.

| Column | Type | Description | Constraints |
|--------|------|-------------|-------------|
| `id` | UUID | Primary key | NOT NULL, DEFAULT gen_random_uuid() |
| `title` | VARCHAR(255) | Item title | NOT NULL |
| `description` | TEXT | Item description | |
| `category` | VARCHAR(50) | Category | NOT NULL, CHECK IN (documentacao, coleta-dados, banco-dados, analise-dados, gestao-riscos, dashboard) |
| `priority` | VARCHAR(10) | Priority level | DEFAULT 'medium', CHECK IN (low, medium, high, critical) |
| `status` | VARCHAR(20) | Item status | DEFAULT 'new', CHECK IN (new, review, in-progress, completed, rejected) |
| `tags` | TEXT[] | Array of tags | DEFAULT '{}' |
| `created_at` | TIMESTAMPTZ | Creation timestamp | NOT NULL, DEFAULT NOW() |
| `updated_at` | TIMESTAMPTZ | Last update | NOT NULL, DEFAULT NOW() |
| `created_by` | VARCHAR(100) | Creator | |
| `updated_by` | VARCHAR(100) | Last updater | |
| `metadata` | JSONB | Additional data | DEFAULT '{}' |

```sql
-- Hypertable with monthly partitioning
SELECT create_hypertable('workspace.workspace_items', 'created_at',
  chunk_time_interval => INTERVAL '1 month');
```

**Indexes**:

- Primary key on `(id, created_at)`
- Single column: `category`, `priority`, `status`, `created_at DESC`, `updated_at DESC`
- GIN indexes: `tags`, `metadata`
- Partial indexes:
  - Active items: `WHERE status NOT IN ('completed', 'rejected')`
  - High priority: `WHERE priority IN ('high', 'critical')`
- Composite: `(category, status, created_at DESC)`, `(priority, status, created_at DESC)`

**Triggers**:

- Auto-update `updated_at` on UPDATE
- Audit logging to `workspace_audit_log` on INSERT/UPDATE/DELETE

#### workspace_audit_log (Hypertable)

Audit trail for all workspace item changes.

| Column | Type | Description | Constraints |
|--------|------|-------------|-------------|
| `id` | UUID | Primary key | NOT NULL, DEFAULT gen_random_uuid() |
| `item_id` | UUID | Referenced item | NOT NULL |
| `action` | VARCHAR(20) | Action type | NOT NULL, CHECK IN (CREATE, UPDATE, DELETE) |
| `changed_by` | VARCHAR(100) | User who made change | |
| `changed_at` | TIMESTAMPTZ | Change timestamp | NOT NULL, DEFAULT NOW() |
| `old_data` | JSONB | Previous state | |
| `new_data` | JSONB | New state | |
| `changes` | JSONB | Delta of changes | |
| `metadata` | JSONB | Additional data | DEFAULT '{}' |

```sql
-- Hypertable with monthly partitioning
SELECT create_hypertable('workspace.workspace_audit_log', 'changed_at',
  chunk_time_interval => INTERVAL '1 month');
```

**Indexes**:

- Primary key on `(id, changed_at)`
- Filter indexes on `item_id`, `action`, `changed_by`, `changed_at DESC`

#### schema_version

Migration version tracking.

| Column | Type | Description | Constraints |
|--------|------|-------------|-------------|
| `version` | VARCHAR(20) | Version identifier | PRIMARY KEY |
| `applied_at` | TIMESTAMPTZ | Application timestamp | NOT NULL, DEFAULT NOW() |
| `description` | TEXT | Migration description | |

---

## PostgreSQL + Prisma Schemas

### documentation-api Database

**Database**: `documentation-api`  
**Port**: 5434  
**Connection**: `postgresql://postgres@localhost:5434/documentation-api`  
**Migrations**: `backend/api/documentation-api/prisma/migrations/`

#### documentation_systems

System registry for documentation organization.

| Column | Type | Description | Constraints |
|--------|------|-------------|-------------|
| `id` | TEXT | Primary key | NOT NULL |
| `name` | VARCHAR(255) | System name | NOT NULL |
| `description` | TEXT | System description | |
| `type` | VARCHAR(100) | System type | NOT NULL |
| `url` | VARCHAR(512) | System URL | |
| `status` | VARCHAR(50) | System status | DEFAULT 'unknown' |
| `owner` | VARCHAR(255) | System owner | |
| `tags` | JSONB | Tags array | DEFAULT '[]' |
| `metadata` | JSONB | Additional metadata | |
| `created_at` | TIMESTAMP(3) | Creation time | NOT NULL, DEFAULT CURRENT_TIMESTAMP |
| `updated_at` | TIMESTAMP(3) | Last update | NOT NULL, DEFAULT CURRENT_TIMESTAMP |

**Indexes**: `status`, `type`, `owner`

#### documentation_ideas

Ideas and feature requests.

| Column | Type | Description | Constraints |
|--------|------|-------------|-------------|
| `id` | TEXT | Primary key | NOT NULL |
| `title` | VARCHAR(255) | Idea title | NOT NULL |
| `description` | TEXT | Idea description | |
| `status` | VARCHAR(50) | Idea status | DEFAULT 'backlog' |
| `category` | VARCHAR(100) | Category | NOT NULL |
| `priority` | VARCHAR(50) | Priority | DEFAULT 'medium' |
| `system_id` | VARCHAR(255) | Related system | FOREIGN KEY → documentation_systems.id |
| `tags` | JSONB | Tags array | DEFAULT '[]' |
| `created_at` | TIMESTAMP(3) | Creation time | NOT NULL, DEFAULT CURRENT_TIMESTAMP |
| `updated_at` | TIMESTAMP(3) | Last update | NOT NULL, DEFAULT CURRENT_TIMESTAMP |

**Indexes**: `status`, `category`, `priority`, `assigned_to`, `created_by`  
**Foreign Keys**: `system_id` → `documentation_systems(id)`

#### documentation_files

File uploads with metadata.

| Column | Type | Description | Constraints |
|--------|------|-------------|-------------|
| `id` | TEXT | Primary key | NOT NULL |
| `filename` | VARCHAR(255) | Stored filename | NOT NULL |
| `original_name` | VARCHAR(255) | Original filename | NOT NULL |
| `mime_type` | VARCHAR(255) | MIME type | NOT NULL |
| `size_bytes` | BIGINT | File size | NOT NULL |
| `file_path` | VARCHAR(1024) | Storage path | NOT NULL |
| `idea_id` | VARCHAR(255) | Related idea | FOREIGN KEY → documentation_ideas.id |
| `system_id` | VARCHAR(255) | Related system | FOREIGN KEY → documentation_systems.id |
| `created_at` | TIMESTAMP(3) | Upload time | NOT NULL, DEFAULT CURRENT_TIMESTAMP |

**Indexes**: `idea_id`, `system_id`, `uploaded_by`  
**Foreign Keys**:

- `idea_id` → `documentation_ideas(id)`
- `system_id` → `documentation_systems(id)`

#### documentation_audit_log

Audit trail for all operations.

| Column | Type | Description | Constraints |
|--------|------|-------------|-------------|
| `id` | TEXT | Primary key | NOT NULL |
| `entity_type` | VARCHAR(50) | Entity type | NOT NULL |
| `entity_id` | VARCHAR(255) | Entity ID | NOT NULL |
| `action` | VARCHAR(50) | Action type | NOT NULL |
| `user_id` | VARCHAR(255) | User who acted | |
| `changes` | JSONB | Change details | |
| `created_at` | TIMESTAMP(3) | Action timestamp | NOT NULL, DEFAULT CURRENT_TIMESTAMP |

**Indexes**: `entity_type`, `entity_id`, `action`

---

## QuestDB Schemas

### tp_capital_signals (QuestDB – Time-Series)

**Status**: Active (production) – Used for time-series data  
**Note**: Relational trading signals moved to TimescaleDB `APPS-TPCAPITAL`

- **Purpose**: Time-series storage for TP Capital Telegram signals
- **Database**: QuestDB
- **Partitioning**: Day partitions for optimal time-series queries
- **Table Definition**:

| Column | Type | Description | Constraints |
|--------|------|-------------|-------------|
| `ts` | TIMESTAMP | Designated timestamp, partitioned by day | NOT NULL, PRIMARY |
| `channel` | SYMBOL | Source channel label | |
| `signal_type` | SYMBOL | Operation type (`Swing Trade`, `Day Trade`) | |
| `asset` | SYMBOL | Asset ticker | |
| `buy_min` | DOUBLE | Lower bound for buy zone | |
| `buy_max` | DOUBLE | Upper bound for buy zone | |
| `target_1` | DOUBLE | First profit target | |
| `target_2` | DOUBLE | Second profit target | |
| `target_final` | DOUBLE | Final profit target | |
| `stop` | DOUBLE | Stop-loss threshold | |
| `raw_message` | STRING | Sanitized Telegram payload | |
| `source` | SYMBOL | Message origin (`forwarder`, `ingestion`) | |
| `ingested_at` | TIMESTAMP | Server-side ingestion timestamp | NOT NULL |

```sql
CREATE TABLE tp_capital_signals (
  ts TIMESTAMP,
  channel SYMBOL,
  signal_type SYMBOL,
  asset SYMBOL,
  buy_min DOUBLE,
  buy_max DOUBLE,
  target_1 DOUBLE,
  target_2 DOUBLE,
  target_final DOUBLE,
  stop DOUBLE,
  raw_message STRING,
  source SYMBOL,
  ingested_at TIMESTAMP
) TIMESTAMP(ts) PARTITION BY DAY;
```

- **Indexes**: Designated timestamp index on `ts`.
- **Access Patterns**: Dashboard filtering by channel, signal type, asset search, 100–1000 row windows.
- **API Integration**:  
  - `GET /signals?limit=500&channel=&type=&search=`  
  - `DELETE /signals` (body uses `ingestedAt`)  
  - `GET /logs?limit=&level=` for ingestion traces.
- **Monitoring**: Prometheus `/metrics`, health checks on `/health`.  
- **Security**: Restrict HTTP/PG ports; bot tokens stored in plaintext require network controls.

---

### tp_capital_signals_deleted (QuestDB – Archive)

- **Purpose**: Soft deletion archive to recover removed signals.
- **Schema**: Mirrors `tp_capital_signals` plus `deleted_at TIMESTAMP`.
- **Retention**: 90 days per retention policy.
- **Workflow**: Dashboard delete → copy rows to archive → rebuild `tp_capital_signals` without removed entries.

---

### telegram_bots (QuestDB – Legacy)

**Status**: Legacy – Migrated to TimescaleDB `APPS-TPCAPITAL`  
**Note**: This QuestDB table remains for historical data only

- **Purpose**: Telegram bot metadata (legacy storage)
- **Current**: Data migrated to TimescaleDB with improved relational schema
- **API Integration**: New CRUD endpoints use TimescaleDB backend

---

### telegram_channels (QuestDB – Legacy)

**Status**: Legacy – Migrated to TimescaleDB `APPS-TPCAPITAL`  
**Note**: This QuestDB table remains for historical data only

- **Purpose**: Monitored Telegram channels (legacy storage)
- **Current**: Data migrated to TimescaleDB with improved relational schema
- **API Integration**: New CRUD endpoints use TimescaleDB backend

---

## Future Schemas

### Order Management (Planned)

**Status**: Draft – Not yet implemented  
**Target Database**: New PostgreSQL/TimescaleDB database

**Planned tables**:

- `trades`: Executed trades tracking
- `positions`: Open positions monitoring
- `strategy_settings`: Strategy configuration
- `risk_limits`: Risk management rules

**Timeline**: To be defined based on Order Manager application requirements

## Data Quality

Operational checks ensure schema integrity and data correctness across all databases.

### TimescaleDB Checks

**APPS-TPCAPITAL**:

- Verify signal ingestion: `SELECT count(*) FROM "tp-capital".tp_capital_signals WHERE created_at > now() - INTERVAL '24 hours'`
- Validate channel and asset fields are not null
- Check for duplicate signals by timestamp and raw_message
- Monitor bot and channel configuration consistency

**APPS-WORKSPACE**:

- Validate required fields: `title`, `category`, `status`, `priority`
- Confirm enums remain within CHECK constraints
- Verify audit log triggers are firing correctly
- Check metadata JSONB structure consistency

### PostgreSQL + Prisma Checks

**documentation-api**:

- Verify foreign key integrity between systems, ideas, and files
- Validate file paths exist on filesystem
- Check audit log completeness for all operations
- Ensure timestamps are properly set

### QuestDB Checks

- Verify time-series ingestion (legacy data)
- Spot-check `raw_message` formatting and numeric fields
- Monitor partition health

### Monitoring

- Track API response times and query performance via Prometheus
- Alert on database connection pool exhaustion
- Monitor disk usage for hypertable partitions
- Alert when LowDB `ideas.json` exceeds 1 MB (migration indicator)
- Trigger alerts if zero rows returned for >10 minutes during market hours

### Incident Response

1. Identify corrupted entries via logs, dashboards, or health checks
2. For TimescaleDB: Use audit logs to track changes and restore from backup if needed
3. For QuestDB legacy data: Move affected rows to archive tables
4. For Prisma: Use migration rollback if schema corruption detected
5. Restore from automated backups for widespread corruption
6. Document findings in audit log and create follow-up tasks

## Related Documentation

- [Database Overview](./overview) – Platform architecture.  
- [Migrations](./migrations) – Strategy and logs.  
- [Retention & Backup](./retention-backup) – Lifecycle policies.  
- TP Capital Service docs (link will be added after migration completes).  
- Data quality runbook migrates separately for operational workflows.
