---
title: Environment Variables Reference
description: Complete reference of all environment variables used in TradingSystem.
tags:
  - tools
  - security
  - environment
  - configuration
owner: SecurityOps
lastReviewed: '2025-11-05'
---
## Overview

TradingSystem uses a **hierarchical environment variable system** with multiple `.env` files loaded in order of precedence. This reference lists every variable, its purpose, default values, and security notes. The governance source of truth lives in `governance/controls/ENVIRONMENT-VARIABLES-POLICY.md`.

## Environment File Hierarchy

The project uses **five artifacts plus one template** to keep secrets and defaults separated:

1. `config/.env.defaults` ‚Äì versioned defaults (non-sensitive, ports, image names).
2. `.env.shared` ‚Äì generated host/port inventory (`npm run ports:sync`), consumed by dashboards/agents; contains zero secrets.
3. `.env` ‚Äì local secrets copied from `.env.example` and filled via `scripts/env/setup-env.sh`.
4. `.env.local` ‚Äì optional overrides for experiments (never committed).
5. `service/.env` ‚Äì per-service overrides under `apps/*` or `backend/*` (gitignored).

Template: `.env.example` (committed) only lists variables that require human-provided values and mirrors this document.

### File Purposes

| File | Purpose | Versioned | When to Edit |
|------|---------|-----------|--------------|
| `config/.env.defaults` | Single source of defaults and non-secret values | ‚úÖ | Whenever a service needs a new default |
| `.env.shared` | Generated map of ports/hosts for agents, docs and dashboards | ‚úÖ | Run `npm run ports:sync`; never hand-edit |
| `.env` | Local secrets (per developer or environment) | ‚ùå | Initial setup, secret rotation |
| `.env.local` | Temporary local overrides | ‚ùå | Debug/test scenarios only |
| `service/.env` | Service-specific overrides (Docker container scope) | ‚ùå | When a service cannot inherit global values |
| `.env.example` | Minimal template containing only required secrets | ‚úÖ | When a new secret is introduced |

### Precedence Rules

**Later files override earlier files**:
- `service/.env` overrides everything
- `.env.local` overrides `.env` and `.env.defaults`
- `.env` overrides `.env.defaults`
- `.env.defaults` provides base values
- `.env.shared` is **not** part of the override chain; it is generated data (ports/hosts) consumed by dashboards, docs and agents.

**Example**:
```bash
# config/.env.defaults
PORT=3500

# .env (root)
# (n√£o define PORT, usa default)

# apps/status/.env
RATE_LIMIT_MAX=200  # Override specific value only

# Result: PORT=3500 (from defaults), RATE_LIMIT_MAX=200 (from service)
```

## Quick Reference

- **Defaults**: [`config/.env.defaults`](https://github.com/marceloterra1983/TradingSystem/blob/main/config/.env.defaults) (333 lines, committed)
- **Your Config**: `.env` (gitignored, copy from `.env.example`)
- **Template**: `.env.example` (committed)
- **Shared Ports**: `.env.shared` (generated via `npm run ports:sync`)
- **Validation**: `bash scripts/env/validate-env.sh`
- **Governan√ßa**: `governance/controls/ENVIRONMENT-VARIABLES-POLICY.md`

> `.env.example` cont√©m apenas segredos obrigat√≥rios; qualquer vari√°vel n√£o listada ali deve ter seu valor padr√£o definido em `config/.env.defaults`.

## Required Variables

| Variable | Description | How to Generate | Example |
|----------|-------------|-----------------|---------|
| `TP_CAPITAL_DB_PASSWORD` | TP Capital dedicated DB password | `openssl rand -base64 32` | `tp_capital_secure_pass_2024` |
| `TELEGRAM_GATEWAY_DB_PASSWORD` | Telegram Gateway dedicated DB password | `openssl rand -base64 32` | `telegram_secure_pass` |
| `WORKSPACE_DATABASE_PASSWORD` | Workspace PostgreSQL password | `openssl rand -base64 32` | `workspace_secure_pass` |
| `PGADMIN_DEFAULT_PASSWORD` | PgAdmin admin password | `openssl rand -base64 32` | `aB3nQ7wR...` |
| `GRAFANA_ADMIN_PASSWORD` | Grafana admin password | `openssl rand -base64 32` | `zY5tM8pK...` |
| `OPENAI_API_KEY` | OpenAI API key | `https://platform.openai.com/api-keys` | `sk-proj-...` |
| `JWT_SECRET_KEY` | JWT signing secret | `openssl rand -hex 32` | `a1b2c3d4...` |

## Database Variables

### TP Capital (Dedicated TimescaleDB)

| Variable | Description | Default | Required |
|----------|-------------|---------|----------|
| `TP_CAPITAL_DB_NAME` | Database name | `tp_capital_db` | No |
| `TP_CAPITAL_DB_USER` | Database user | `tp_capital` | No |
| `TP_CAPITAL_DB_PASSWORD` | Database password | ‚Äì | **Yes** |
| `TP_CAPITAL_DB_HOST` | Host (PgBouncer) | `localhost` | No |
| `TP_CAPITAL_DB_PORT` | Host port (PgBouncer) | `5440` | No |
| `TP_CAPITAL_PGBOUNCER_PORT` | PgBouncer port (inside stack) | `6435` | No |
| `TP_CAPITAL_DB_SCHEMA` | Schema | `signals` | No |

- **Stack**: `tools/compose/docker-compose.tp-capital-stack.yml`.  
- **Connection String**: `postgresql://${TP_CAPITAL_DB_USER}:${TP_CAPITAL_DB_PASSWORD}@${TP_CAPITAL_DB_HOST}:${TP_CAPITAL_DB_PORT}/${TP_CAPITAL_DB_NAME}`.  
- **Security**: Secrets stored per stack; PgBouncer enforces connection pooling.

### Telegram Gateway (Dedicated TimescaleDB)

| Variable | Description | Default | Required |
|----------|-------------|---------|----------|
| `TELEGRAM_GATEWAY_DB_NAME` | Database name | `telegram_gateway` | No |
| `TELEGRAM_GATEWAY_DB_USER` | Database user | `telegram` | No |
| `TELEGRAM_GATEWAY_DB_PASSWORD` | Database password | ‚Äì | **Yes** |
| `TELEGRAM_GATEWAY_DB_HOST` | Host | `localhost` | No |
| `TELEGRAM_GATEWAY_DB_PORT` | Host port | `5434` | No |
| `TELEGRAM_GATEWAY_DB_SCHEMA` | Schema | `telegram_gateway` | No |

- **Stack**: `tools/compose/docker-compose.telegram.yml`.  
- **Connection String**: `postgresql://${TELEGRAM_GATEWAY_DB_USER}:${TELEGRAM_GATEWAY_DB_PASSWORD}@${TELEGRAM_GATEWAY_DB_HOST}:${TELEGRAM_GATEWAY_DB_PORT}/${TELEGRAM_GATEWAY_DB_NAME}`.  
- **Security**: database isolado (TimescaleDB) + PgBouncer interno no stack.

### Workspace (Dedicated PostgreSQL)

| Variable | Description | Default | Required |
|----------|-------------|---------|----------|
| `WORKSPACE_DATABASE_NAME` | Database name | `workspace` | No |
| `WORKSPACE_DATABASE_USER` | Database user | `postgres` | No |
| `WORKSPACE_DATABASE_PASSWORD` | Database password | ‚Äì | **Yes** |
| `WORKSPACE_DATABASE_HOST` | Host | `localhost` | No |
| `WORKSPACE_DATABASE_PORT` | Host port | `5450` | No |
| `WORKSPACE_DATABASE_SCHEMA` | Schema | `workspace` | No |

- **Stack**: `tools/compose/docker-compose.workspace-simple.yml`.  
- **Connection String**: `postgresql://${WORKSPACE_DATABASE_USER}:${WORKSPACE_DATABASE_PASSWORD}@${WORKSPACE_DATABASE_HOST}:${WORKSPACE_DATABASE_PORT}/${WORKSPACE_DATABASE_NAME}?schema=${WORKSPACE_DATABASE_SCHEMA}`.

## Admin UI Variables

### PgAdmin (Descontinuado)

- O stack compartilhado que hospedava PgAdmin/Adminer/PgWeb foi removido em 2025-11-05. Utilize tooling local (psql, DBeaver, TablePlus) ou configure inst√¢ncias espec√≠ficas dentro de cada stack dedicado conforme necess√°rio.

### Grafana

| Variable | Description | Default | Required |
|----------|-------------|---------|----------|
| `GRAFANA_ADMIN_USER` | Admin username | `admin` | No |
| `GRAFANA_ADMIN_PASSWORD` | Admin password | ‚Äì | **Yes** |

- **Access**: `http://localhost:3000`.  
- **Stacks**: `monitoring/docker-compose.yml`.

## AI & ML Variables

| Variable | Description | Default | Required |
|----------|-------------|---------|----------|
| `OPENAI_API_KEY` | OpenAI API key for LlamaIndex | ‚Äì | **Yes** |
| `QDRANT_API_KEY` | Qdrant API key | ‚Äì | No |
| `RATE_LIMIT_REQUESTS` | Rate limit count | `100` | No |
| `RATE_LIMIT_PERIOD` | Rate limit window (seconds) | `60` | No |
| `LOG_LEVEL` | Logging verbosity | `INFO` | No |

- **Services**: `docker-compose.infra.yml`.  
- **Security**: Rotate API keys every 180 days, monitor usage, apply least privilege.

## Monitoring Variables

| Variable | Description | Default | Required |
|----------|-------------|---------|----------|
| `SLACK_WEBHOOK_URL` | Slack alerts webhook | ‚Äì | No |
| `GITHUB_TOKEN` | GitHub PAT for automation | ‚Äì | No |
| `GITHUB_OWNER` | Repository owner | `marceloterra` | No |
| `GITHUB_REPO` | Repository name | `TradingSystem` | No |

- **Notes**: Use read-only scopes, rotate tokens every 180 days, revoke immediately on compromise.

## Backend API Variables

| Variable | Description | Default | Required |
|----------|-------------|---------|----------|
| `WORKSPACE_PORT` | Workspace API port | `3100` | No |
| `WORKSPACE_TABLE_NAME` | Workspace table | `workspace_items` | No |
| `TP_CAPITAL_PORT` | TP Capital API port | `3200` | No |
| `TELEGRAM_BOT_TOKEN` | Telegram bot token | ‚Äì | No |
| `TELEGRAM_CHAT_ID` | Telegram chat ID | ‚Äì | No |
| `QUESTDB_HTTP_URL` | QuestDB URL | `http://localhost:9002` | No |
| `DOCS_API_PORT` | Documentation API port | `3405` | No |

- **Security**: Protect Telegram tokens, rotate quarterly, validate all API inputs.

## Frontend Variables

### Core URLs

| Variable | Description | Default | Required |
|----------|-------------|---------|----------|
| `VITE_API_URL` | API base URL | `http://localhost:4010` | No |
| `VITE_WS_URL` | WebSocket URL | `ws://localhost:4010` | No |
| `VITE_QUESTDB_URL` | QuestDB URL | `http://localhost:9002` | No |
| `VITE_PROMETHEUS_URL` | Prometheus URL | `http://localhost:9090` | No |

### Proxy Overrides

| Variable | Purpose | Default |
|----------|---------|---------|
| `VITE_DASHBOARD_PORT` | Dev server port | `3103` |
| `VITE_WORKSPACE_PROXY_TARGET` | Workspace proxy target | `http://localhost:3100/api` |
| `VITE_TP_CAPITAL_PROXY_TARGET` | TP Capital proxy target | `http://localhost:3200` |
| `VITE_DOCUMENTATION_PROXY_TARGET` | Documentation proxy | `http://localhost:3400` |
| `VITE_FIRECRAWL_PROXY_TARGET` | Firecrawl proxy | `http://localhost:3600` |
| `VITE_DOCUSAURUS_PROXY_TARGET` | Documentation Hub proxy | `http://localhost:3400` |
| `VITE_MCP_PROXY_TARGET` | MCP server proxy | `http://localhost:3847` |

```bash
# Override example for containerized gateway
VITE_WORKSPACE_PROXY_TARGET=http://tradingsystem.local/workspace
VITE_TP_CAPITAL_PROXY_TARGET=http://tradingsystem.local/tp-capital
```

## Security Variables

| Variable | Description | Default | Required |
|----------|-------------|---------|----------|
| `CORS_ORIGIN` | Allowed origins (comma-separated) | `http://localhost:3103,http://localhost:3400,http://localhost:3401` | No |
| `JWT_SECRET_KEY` | JWT signing secret | ‚Äì | **Yes** |
| `RATE_LIMIT_WINDOW_MS` | Rate limit window (ms) | `60000` | No |
| `RATE_LIMIT_MAX` | Requests per window | `120` | No |

- **Security**: Use strong 64 hex char JWT secrets, rotate annually, scope CORS to production domains.

## Validation

### Validation Script

```bash
bash scripts/env/validate-env.sh
```

- Checks for required variables, placeholder values, file permissions, and optional warnings.

### Docker Compose Validation

```bash
docker compose -f tools/compose/docker-compose.timescale.yml config
docker compose -f tools/compose/docker-compose.infra.yml config
docker compose -f tools/monitoring/docker-compose.yml config
```

- Ensures environment variables interpolate cleanly.

## Secret Generation

- **Passwords (32 chars)**: `openssl rand -base64 32`.  
- **JWT Secrets (64 hex)**: `openssl rand -hex 32`.  
- **API Keys (32 hex)**: `openssl rand -hex 16`.

## Rotation Schedule

| Secret Type | Rotation Frequency | Procedure |
|-------------|-------------------|-----------|
| Database passwords | 90 days | Generate new, update `.env`, restart services |
| Admin UI passwords | 90 days | Generate new, update `.env`, restart services |
| API keys | 180 days | Generate new, update `.env`, revoke old |
| JWT secrets | 365 days | Generate new, update `.env`, invalidate tokens |
| Telegram bot tokens | 90 days | Regenerate via BotFather, update `.env` |

## .env Policy and Best Practices

### ‚úÖ When to Use Service-Specific .env

Create `service/.env` **ONLY** when:

1. **Service-specific authentication tokens** (not shared)
   ```bash
   # ‚úÖ OK: apps/telegram-gateway/.env
   TELEGRAM_API_ID=12345678
   TELEGRAM_API_HASH=abc123...
   ```

2. **Development overrides** for testing
   ```bash
   # ‚úÖ OK: backend/api/workspace/.env
   LOG_LEVEL=debug  # Override default 'info' for debugging
   ```

3. **Environment-dependent URLs** (local vs container)
   ```bash
   # ‚úÖ OK: backend/api/telegram-gateway/.env
   # Use localhost:5433 when running LOCALLY (not in container)
   TELEGRAM_GATEWAY_DB_URL=postgresql://...@localhost:5433/...
   ```

### ‚ùå When NOT to Use Service-Specific .env

**DO NOT** create service `.env` for:

1. **Shared variables** already in `config/.env.defaults`
   ```bash
   # ‚ùå WRONG: apps/status/.env
   PORT=3500  # Already in .env.defaults!
   CORS_ORIGIN=http://localhost:3103  # Duplicated!
   ```

2. **Secrets that should be in root .env**
   ```bash
   # ‚ùå WRONG: service/.env
   TP_CAPITAL_DB_PASSWORD=secret  # Should be in root .env only!
   ```

3. **Configuration that affects multiple services**
   ```bash
   # ‚ùå WRONG: service/.env
   TP_CAPITAL_DB_HOST=tp-capital-pgbouncer  # Configure via config/.env.defaults + overrides
   ```

### üìã Service .env Template

When creating a service `.env`, always include header:

```bash
# ==============================================================================
# [Service Name] - Service-Specific Overrides
# ==============================================================================
# Este arquivo sobrescreve defaults de config/.env.defaults
# Apenas vari√°veis ESPEC√çFICAS deste servi√ßo ou overrides de desenvolvimento
# ==============================================================================

# [Justificativa aqui]
VARIABLE_NAME=value
```

### üîç Review Checklist

Before committing changes to `.env.defaults` or creating service `.env`:

- [ ] Variable is not duplicated in multiple files
- [ ] Secrets are in root `.env` (gitignored), not in service `.env`
- [ ] Service `.env` has clear header explaining overrides
- [ ] Updated `.env.example` if adding new required variables
- [ ] Tested load order with `node -e "console.log(process.env.VARIABLE)"`

## Related Documentation

- [Security Overview](./overview).
- [Risk Limits](./risk-limits).
- [Security Audit Procedures](./audit).
- [Environment Loader Implementation](https://github.com/marceloterra1983/TradingSystem/blob/main/backend/shared/config/load-env.js)
- Environment configuration narrative now lives in `docs/content/ops/`.
