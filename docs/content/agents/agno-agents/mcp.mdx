---
title: MCP Integration
description: MCP capabilities and permissions required by the Order Manager agents.
tags:
  - agents
  - order-manager
  - mcp
owner: MCPGuild
lastReviewed: '2025-10-26'
---
## Overview

Agno Agents currently do **not directly integrate with MCP servers**. The agents operate as a standalone FastAPI service that consumes REST APIs and WebSocket streams.

**Current Architecture**:
- Agno Agents: Python service (port 8200)
- MCP Servers: Claude Code CLI integration (stdio transport)
- No direct communication between Agno Agents and MCP servers

**Future Integration** (planned):
- Agno Agents could expose MCP-compatible tools
- MCP servers could invoke Agno Agents via HTTP
- Unified agent orchestration via MCP protocol

## Capabilities

While Agno Agents don't currently use MCP, they provide capabilities that **could be exposed as MCP tools** in the future:

### Potential MCP Tools

**Market Analysis Tools**:
- `analyze_market`: Generate trading signals for symbols
  - Input: `{ "symbols": ["PETR4"], "include_tp_capital": true }`
  - Output: List of MarketSignal entities
  - Permission scope: `market-data:read`, `signals:generate`

- `get_tp_capital_signals`: Fetch TP Capital Telegram signals
  - Input: `{ "limit": 100, "channel": "TP_Capital" }`
  - Output: List of TP Capital signals
  - Permission scope: `tp-capital:read`

**Risk Management Tools**:
- `validate_signal`: Validate trading signal against risk policies
  - Input: MarketSignal entity
  - Output: RiskAssessment entity
  - Permission scope: `risk:validate`

- `check_daily_loss_limit`: Check if daily loss limit exceeded
  - Input: None
  - Output: `{ "passed": true, "current_loss": 1250, "limit": 5000 }`
  - Permission scope: `risk:read`

- `check_position_size`: Validate position size for symbol
  - Input: `{ "symbol": "PETR4", "size": 100 }`
  - Output: `{ "passed": true, "current_position": 750, "limit": 1000 }`
  - Permission scope: `risk:read`

**Orchestration Tools**:
- `orchestrate_analysis`: Full workflow (analyze + validate)
  - Input: `{ "action": "ORCHESTRATE", "data": { "symbols": ["PETR4"] } }`
  - Output: OrchestrationResponse with signals and assessments
  - Permission scope: `agents:orchestrate`

### Permission Scopes (Planned)

**Read Permissions**:
- `market-data:read`: Access market data (TP Capital)
- `workspace:read`: Access workspace ideas
- `risk:read`: Read risk limits and current positions
- `agents:status`: Check agent health and status

**Write Permissions**:
- `signals:generate`: Generate trading signals
- `risk:validate`: Validate signals against risk policies
- `agents:orchestrate`: Execute full agent workflows

**Admin Permissions**:
- `agents:configure`: Update agent configuration
- `agents:restart`: Restart agent service
- `risk:update`: Modify risk limits

## Current Integration Pattern

### HTTP REST API

**Base URL**: `http://localhost:8200`

**Endpoints**:
- `POST /api/v1/agents/analyze` - Market analysis
- `POST /api/v1/agents/signals` - Signal orchestration
- `GET /api/v1/agents/status` - Agent status
- `GET /health` - Service health
- `GET /metrics` - Prometheus metrics

**Authentication**: None (internal service)

**Rate Limiting**: 100 requests per 60 seconds (configurable via `AGNO_RATE_LIMIT_REQUESTS`)

**CORS**: Allowed origins from `AGNO_CORS_ORIGINS` (default: `http://localhost:3103`, `http://localhost:3205`)

### Dashboard Integration

**Proxy Configuration**:
```javascript
'/api/agents': {
  target: 'http://localhost:8200',
  changeOrigin: true,
  rewrite: (path) => path.replace(/^\/api\/agents/, '/api/v1/agents')
}
```

**Usage Example**:
```typescript
import { useQuery } from '@tanstack/react-query';

function useMarketAnalysis(symbols: string[]) {
  return useQuery({
    queryKey: ['market-analysis', symbols],
    queryFn: async () => {
      const response = await fetch('/api/agents/analyze', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          symbols,
          include_tp_capital: true,
          include_b3: true
        })
      });
      return response.json();
    },
    staleTime: 60000,
  });
}
```

## Future MCP Integration

### Agno Agents as MCP Server

**Approach**: Expose Agno Agents capabilities as MCP tools

**Configuration**:
```json
{
  "mcpServers": {
    "agno-agents": {
      "url": "http://localhost:8200/mcp",
      "transport": "http",
      "auth": {
        "type": "bearer",
        "token": "${AGNO_MCP_TOKEN}"
      }
    }
  }
}
```

**Tools Exposed**:
- `analyze_market`: Generate trading signals
- `validate_signal`: Risk validation
- `orchestrate_workflow`: Full agent orchestration
- `get_agent_status`: Health check

**Benefits**:
- AI assistants can invoke agents directly
- Unified tool calling interface
- Standardized permission model
- Audit logging via MCP

---

### MCP Servers Consumed by Agents

**Approach**: Agno Agents invoke MCP tools for enhanced capabilities

**Use Cases**:
- **fetch MCP server**: Fetch external market data (news, social sentiment)
- **memory MCP server**: Store and retrieve trading patterns
- **sequential-thinking MCP server**: Multi-step reasoning for complex analysis

**Example Integration**:
```python
from mcp_client import MCPClient

mcp = MCPClient(server="fetch")
response = await mcp.call_tool(
    "fetch_url",
    url="https://api.example.com/market-news",
    method="GET"
)
news_data = response.json()
```

**Benefits**:
- Access external data sources
- Leverage MCP ecosystem (memory, search, reasoning)
- Standardized error handling and retries

## Permissions

### Current Permissions (HTTP API)

**No Authentication**: Internal service, no permission model

**Network Security**:
- Bind to localhost only (not 0.0.0.0)
- CORS restricted to Dashboard and Docusaurus
- Rate limiting (100 req/60s)

**Future Permissions** (when MCP integration added):

**Read Permissions**:
- `agno:market-data:read`: Access market data APIs
- `agno:workspace:read`: Access workspace ideas
- `agno:risk:read`: Read risk limits

**Execute Permissions**:
- `agno:signals:generate`: Generate trading signals
- `agno:risk:validate`: Validate signals
- `agno:orchestrate`: Execute full workflows

**Admin Permissions**:
- `agno:config:update`: Modify agent configuration
- `agno:service:restart`: Restart agent service

### Approval Workflows (Planned)

**Automatic Approval**:
- Read operations (market data, workspace ideas)
- Signal generation (non-destructive)
- Risk validation (read-only checks)

**Confirmation Required**:
- Risk limit updates (affects trading safety)
- Agent configuration changes (affects behavior)
- Service restart (causes downtime)

**Escalation**:
- Production deployments → Team lead approval
- Risk policy changes → Risk manager approval
- Architecture changes → ArchitectureGuild review

## Monitoring

### Prometheus Metrics

**Agent Metrics**:
- `agent_decisions_total{agent_name, decision_type}`: Total decisions by agent and type
- `agent_processing_seconds_bucket{agent_name}`: Processing time histogram
- `agent_errors_total{agent_name, error_type}`: Error counts by agent and type

**API Metrics**:
- `api_requests_total{method, endpoint, status}`: Request counts
- `api_request_duration_seconds_bucket{method, endpoint}`: Request latency histogram

**Dependency Metrics**:
- `dependency_status{dependency}`: Dependency health (0=down, 1=up)

**Example Queries**:
```promql
rate(agent_decisions_total[5m])
histogram_quantile(0.95, rate(agent_processing_seconds_bucket[5m]))
rate(agent_errors_total[5m]) / rate(agent_decisions_total[5m])
dependency_status{dependency="tp_capital_api"}
```

### Health Checks

**GET /health** (simple):
- Uses cached snapshot
- Fast response (&lt;50ms)
- Returns: `{ "status": "healthy" }`

**GET /health?detailed=true** (comprehensive):
- Executes `ping()` probes with timeout
- Checks all dependencies (TP Capital, Workspace, Risk Engine)
- Updates `dependency_status` gauge
- Returns: `{ "status": "healthy", "dependencies": { "tp_capital_api": "connected", ... } }`

**Alerting**:
- Alert if any dependency down for &gt;5 minutes
- Alert if agent error rate &gt;5% for 10 minutes
- Alert if processing latency &gt;2s p95

## Related Documentation

- [Agent Overview](/agents/agno-agents) - Agent responsibilities
- [Agent Flows](./flows) - Execution flows
- [Agent Prompts](./prompts) - Prompt templates
- [Agent Tests](./tests) - Test suite
- [MCP Registry](../../mcp/registry) - MCP server catalog
- [MCP Permissions](../../mcp/permissions) - Permission model
