---
title: Plano de Evolu√ß√£o de Cobertura de Testes
slug: /governance/test-plan
description: Estrat√©gia faseada para elevar a cobertura de testes do TradingSystem at√© as metas do Plano de Melhoria v1.0.
tags:
  - governance
  - testing
  - quality
owner: QAOps
lastReviewed: "2025-11-12"
sidebar_label: Test Coverage Roadmap
sidebar_position: 45
---

# Plano de Evolu√ß√£o de Cobertura de Testes

**Contexto**: O Plano de Melhoria (v1.0) estabelece meta de cobertura m√≠nima de 75% (linhas) na Fase 2 e 85% ao final da Fase 4. Este documento detalha como alcan√ßaremos os marcos intermedi√°rios a partir do baseline de novembro/2025.

## üéØ Metas por Fase

| Fase | Branches | Functions | Lines | Statements | Observa√ß√µes |
|------|----------|-----------|-------|------------|-------------|
| Baseline (2025-11-10) | 50% | 30% | 30% | 30% | Cobertura majoritariamente em testes de UI isolados |
| **Fase 2** (Nova) | **70%** | **60%** | **65%** | **65%** | Thresholds j√° configurados em `vitest.config.ts` |
| Fase 3 | 75% | 70% | 75% | 75% | Entra su√≠te integrada (Playwright + Pact) |
| Fase 4 | 80% | 80% | 85% | 85% | Cobertura consolidada com contratos + tracing |

> ‚ö†Ô∏è Ao quebrar um threshold, o pipeline `CI Pipeline / Test Coverage` falhar√° automaticamente. Mantenha o arquivo `frontend/dashboard/vitest.config.ts` como fonte de verdade.

## üß≠ Roadmap (Sprints 46-49)

| Sprint | Objetivo | Servi√ßos / Apps | Entreg√°veis |
|--------|----------|-----------------|-------------|
| 46 | Cobertura de utilit√°rios cr√≠ticos | `frontend/dashboard/src/utils`, `services/*` | Novos testes unit√°rios cobrindo valida√ß√µes do Firecrawl, formata√ß√£o de datas e adaptadores de API |
| 47 | Cobertura de hooks de neg√≥cio | `hooks/useAgentsData`, `hooks/useCollections` | Mock de React Query + dados fakes com Vitest |
| 48 | Cobertura de stores Zustand | `store/appStore.ts`, `store/toastStore.ts` | Testes de reducers + selectors |
| 49 | Refor√ßo de integra√ß√µes | `services/*`, `components/pages/*` | Smoke tests com Vitest + MSW para fluxos principais |

## ‚úÖ M√≥dulos Priorit√°rios (Fase 2)

1. **Firecrawl Scraper** ‚Äì Fun√ß√µes de `utils/validation.ts` e `services/firecrawlService.ts`
2. **Gateway TP Capital** ‚Äì Utilidades de filtros (`components/pages/tp-capital/utils.ts`)
3. **Cole√ß√µes RAG** ‚Äì Hooks `hooks/llamaIndex/*`
4. **Workspace Library** ‚Äì `services/workspaceService.ts` e `services/collectionsService.ts`

Cada m√≥dulo precisa de cobertura m√≠nima de **60%** at√© o final da sprint 48. Relat√≥rios por m√≥dulo ser√£o publicados em `docs/reports/coverage/module-<name>.json`.

## üîÑ Processos Atualizados

- `npm run test:coverage` agora gera e envia `coverage/lcov.info` para o Codecov.
- `node scripts/testing/enforce-coverage-targets.mjs` roda no CI (modo warn-only) comparando com `config/quality/coverage-targets.json`.
- Novos testes devem incluir `describe` com contexto e cobrir branches alternativos (erros + caminhos felizes).
- Adotamos `@testing-library/react` e `@testing-library/user-event` para componentes. Para hooks, usar `renderHook`.
- Mock de `fetch/axios` com `vi.mock` e `vi.spyOn`.

## üìÇ Estrutura de Pastas Recomendada

```
src/
  utils/
    __tests__/validation.test.ts      # Novos testes desta fase
  services/
    __tests__/firecrawlService.test.ts
  hooks/
    __tests__/useAgentsData.test.tsx
```

> Padronize com `__tests__` ao lado do m√≥dulo quando poss√≠vel. Para grandes su√≠tes, prefira `src/__tests__/integration`.

## üß™ Reporte de M√©tricas

- `npm run test:coverage -- --reporter=json-summary` ‚Üí gera `coverage/coverage-summary.json`
- Script `scripts/testing/export-module-coverage.mjs` (em desenvolvimento) agregar√° cobertura por diret√≥rio.
- Dashboard no Codecov: `https://app.codecov.io/gh/marceloterra1983/TradingSystem`.
- Badge atualizado em `README.md`.

## üë• Respons√°veis

| Atividade | Respons√°vel | When |
|-----------|-------------|------|
| Revis√£o semanal dos gaps | QAOps + Eng. respons√°vel do m√≥dulo | Segundas, stand-up |
| Pull Request Review | Pelo menos 1 revisores com foco em testes | Todas as PRs |
| Atualiza√ß√£o deste plano | QAOps | Mensal ou quando thresholds mudarem |

## üìå Checklist por PR

- [ ] Incluiu testes cobrindo o fluxo alterado?
- [ ] Rodou `npm run test:coverage` localmente?
- [ ] Verificou alerta do Codecov (coment√°rio no PR)?
- [ ] Atualizou mocks/dados de teste para cen√°rios novos?
- [ ] Documentou exce√ß√µes (quando teste n√£o √© aplic√°vel) em coment√°rio na PR?

## üö® Plano de Conting√™ncia

Caso um threshold seja quebrado:

1. Pipeline trava o merge.
2. Dono da PR executa `npm run test -- --runInBand --coverage false` para identificar suites problem√°ticas.
3. Se queda for decorrente de remo√ß√£o planejada, abrir issue `quality debt` com plano de reposi√ß√£o em at√© 2 sprints.

---

**√öltima atualiza√ß√£o**: `2025-11-12` ‚Äî Thresholds ajustados e roadmap de m√≥dulos cr√≠ticos definido.

