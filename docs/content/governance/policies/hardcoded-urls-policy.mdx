---
title: Pol√≠tica de Preven√ß√£o de URLs Hardcoded
description: Diretrizes para preven√ß√£o de URLs hardcoded e uso correto de
  proxies Vite no frontend.
slug: /governance/policies/hardcoded-urls-policy
tags:
  - frontend
  - vite
  - proxy
  - configuration
owner: FrontendEngineering
lastReviewed: 2025-11-08
sidebar_label: POL-0005 - Hardcoded URLs Prevention
sidebar_position: 8
---

<!-- AUTO-GENERATED from governance source. Do not edit in docs/content. -->

---
title: Hardcoded URLs Prevention Policy
domain: governance
type: policy
tags: [security, quality, automation]
status: active
last_review: "2025-11-08"
summary: Pol√≠tica de 5 camadas para prevenir URLs hardcoded no c√≥digo e garantir configura√ß√£o via vari√°veis de ambiente
---

# Hardcoded URLs Prevention Policy

## üéØ Objetivo

**Garantir que NENHUMA URL hardcoded seja commitada no reposit√≥rio**, exigindo que todas as URLs sejam configuradas via vari√°veis de ambiente.

## üìã Motiva√ß√£o

URLs hardcoded causam:
- ‚ùå **Quebra em ambientes diferentes** (dev/staging/prod)
- ‚ùå **Falhas em containers** (hostnames n√£o resolvem)
- ‚ùå **Dificuldade de manuten√ß√£o** (mudan√ßas requerem edi√ß√£o de c√≥digo)
- ‚ùå **Problemas de seguran√ßa** (exposi√ß√£o de endpoints internos)

## üõ°Ô∏è Pol√≠tica de 5 Camadas

### Camada 1: Pre-commit Hook (Bloqueio Imediato)

**Status**: ‚úÖ **IMPLEMENTADO**

**Arquivo**: `.husky/pre-commit`

**Valida√ß√£o**: Executa `npm run ports:scan-hardcoded` em **TODOS os commits** (n√£o apenas mudan√ßas em `config/ports/`)

```bash
# Sempre executar scan de hardcoded URLs
echo "üîé Scanning for hardcoded localhost URLs..."
npm run ports:scan-hardcoded
```

**A√ß√£o**: Se detectar URLs hardcoded ‚Üí **BLOQUEIA o commit**

**Arquivo validado**: `tools/ports/scan-hardcoded.js`

---

### Camada 2: ESLint Rules (Valida√ß√£o em Tempo de Desenvolvimento)

**Status**: ‚ö†Ô∏è **PARCIALMENTE IMPLEMENTADO** (apenas frontend/dashboard)

**Arquivo**: `.eslintrc.json` (raiz do projeto - ser√° criado)

**Regras**:

```json
{
  "rules": {
    "no-restricted-syntax": [
      "error",
      {
        "selector": "Literal[value=/^https?:\\/\\/localhost:[0-9]{1,5}/]",
        "message": "‚ùå Use environment variables instead of hardcoded localhost URLs. See governance/controls/hardcoded-urls-prevention-policy.md"
      },
      {
        "selector": "Literal[value=/^https?:\\/\\/127\\.0\\.0\\.1:[0-9]{1,5}/]",
        "message": "‚ùå Use environment variables instead of hardcoded 127.0.0.1 URLs. See governance/controls/hardcoded-urls-prevention-policy.md"
      },
      {
        "selector": "TemplateElement[value.raw=/https?:\\/\\/localhost:[0-9]{1,5}/]",
        "message": "‚ùå Use environment variables instead of hardcoded localhost URLs in template literals. See governance/controls/hardcoded-urls-prevention-policy.md"
      }
    ]
  }
}
```

**Aplica√ß√£o**:
- ‚úÖ Frontend: `frontend/dashboard/.eslintrc.json`
- ‚úÖ Backend APIs: `backend/api/**/.eslintrc.json`
- ‚úÖ Apps: `apps/**/.eslintrc.json`

**A√ß√£o**: Se detectar URLs hardcoded ‚Üí **ERRO no editor (IDE)** + **Falha em `npm run lint`**

---

### Camada 3: CI/CD Validation (GitHub Actions)

**Status**: ‚ö†Ô∏è **PARCIALMENTE IMPLEMENTADO** (apenas em alguns workflows)

**Arquivo**: `.github/workflows/code-quality.yml`

**Valida√ß√£o**: Executar validadores em **TODOS os PRs**

```yaml
- name: Validate Port Registry & Hardcoded URLs
  run: |
    npm run ports:validate
    npm run ports:scan-hardcoded

- name: Run ESLint (All Projects)
  run: |
    npm run lint:all
```

**A√ß√£o**: Se detectar URLs hardcoded ‚Üí **FALHA no CI** ‚Üí **Bloqueia merge do PR**

---

### Camada 4: Code Review Checklist

**Status**: ‚ö†Ô∏è **N√ÉO IMPLEMENTADO** (ser√° adicionado ao PR template)

**Arquivo**: `.github/PULL_REQUEST_TEMPLATE.md`

**Checklist obrigat√≥rio**:

```markdown
## üîê Security & Configuration

- [ ] ‚úÖ **No hardcoded URLs** - All URLs use environment variables (`.env` or `.env.defaults`)
- [ ] ‚úÖ **ESLint passes** - `npm run lint:all` without hardcoded URL warnings
- [ ] ‚úÖ **Port registry updated** - New services added to `config/ports/registry.yaml`
- [ ] ‚úÖ **Environment variables documented** - Added to `config/.env.defaults` with comments
```

**A√ß√£o**: Revisor deve verificar **manualmente** antes de aprovar PR

---

### Camada 5: Documentation & Templates

**Status**: ‚úÖ **IMPLEMENTADO** (parcialmente)

**Documenta√ß√£o**:
- ‚úÖ `docs/content/frontend/engineering/PROXY-BEST-PRACTICES.md` (Frontend)
- ‚úÖ `CLAUDE.md` - Se√ß√£o "CRITICAL: Environment Variables Configuration"
- ‚ö†Ô∏è **FALTANDO**: Template de c√≥digo para novos servi√ßos

**Template de c√≥digo** (criar em `scripts/templates/new-service-template.js`):

```javascript
// ‚úÖ CORRETO: Sempre usar vari√°veis de ambiente
const config = {
  apiUrl: process.env.API_URL, // ‚úÖ Sem fallback hardcoded
  port: process.env.PORT || 3000, // ‚úÖ OK: fallback num√©rico
  timeout: Number(process.env.TIMEOUT) || 5000, // ‚úÖ OK: valor num√©rico
};

// ‚ùå ERRADO: Fallback hardcoded com URL
const badConfig = {
  apiUrl: process.env.API_URL || "http://localhost:3000", // ‚ùå NUNCA!
};

// Valida√ß√£o: Falhar se vari√°vel obrigat√≥ria n√£o existir
if (!config.apiUrl) {
  throw new Error('Missing required environment variable: API_URL');
}
```

**A√ß√£o**: Desenvolvedores usam template ‚Üí **Menos chance de erro**

---

## üöÄ Implementa√ß√£o Imediata

### ‚úÖ Conclu√≠do (2025-11-08)

1. ‚úÖ **Removidos hardcoded URLs** de 4 arquivos backend
2. ‚úÖ **Adicionadas vari√°veis** ao `config/.env.defaults`
3. ‚úÖ **Valida√ß√£o funcional**: `npm run ports:scan-hardcoded` passa

### üîß Pendente (Pr√≥ximos Passos)

#### 1. Atualizar Pre-commit Hook (PRIORIDADE ALTA)

```bash
# Editar .husky/pre-commit
# Adicionar valida√ß√£o SEMPRE (n√£o apenas em mudan√ßas de ports)

echo "üîé Scanning for hardcoded localhost URLs..."
npm run ports:scan-hardcoded || {
  echo "‚ùå Hardcoded localhost URLs detected!"
  echo "üìñ See governance/controls/hardcoded-urls-prevention-policy.md"
  exit 1
}
```

#### 2. Criar ESLint Config Global (PRIORIDADE ALTA)

```bash
# Criar .eslintrc.json na raiz
# Aplicar regras em todos os projetos backend
npm install --save-dev eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin
```

#### 3. Atualizar CI Workflows (PRIORIDADE M√âDIA)

```bash
# Editar .github/workflows/code-quality.yml
# Adicionar valida√ß√£o de hardcoded URLs em TODOS os PRs
```

#### 4. Atualizar PR Template (PRIORIDADE M√âDIA)

```bash
# Editar .github/PULL_REQUEST_TEMPLATE.md
# Adicionar checklist de hardcoded URLs
```

#### 5. Criar Template de Novo Servi√ßo (PRIORIDADE BAIXA)

```bash
# Criar scripts/templates/new-service-template.js
# Documentar em docs/content/reference/templates/
```

---

## üìä M√©tricas de Sucesso

### Indicadores

- **Zero commits com hardcoded URLs** nos √∫ltimos 30 dias
- **100% de cobertura ESLint** em todos os projetos TypeScript/JavaScript
- **CI passa em 100% dos PRs** (sem warnings de hardcoded URLs)
- **Tempo m√©dio de detec√ß√£o** < 1 minuto (pre-commit hook)

### Dashboards

- GitHub Actions: Status dos workflows `code-quality.yml`
- ESLint Report: `npm run lint:all --format json > eslint-report.json`

---

## üîó Refer√™ncias

### Documenta√ß√£o Relacionada

- [Proxy Best Practices](../../docs/content/frontend/engineering/PROXY-BEST-PRACTICES.md)
- [Environment Variables Guide](../../docs/content/tools/security-config/env.mdx)
- [Port Registry Documentation](../../config/ports/README.md)
- [CLAUDE.md - Environment Variables](../../CLAUDE.md#-critical-environment-variables-configuration)

### Tools

- **Scanner**: `tools/ports/scan-hardcoded.js`
- **Validator**: `tools/ports/validate.js`
- **ESLint Config**: `frontend/dashboard/.eslintrc.json` (exemplo)

---

## üìù Hist√≥rico de Revis√µes

| Data | Vers√£o | Mudan√ßas | Autor |
|------|--------|----------|-------|
| 2025-11-08 | 1.0.0 | Pol√≠tica inicial criada ap√≥s incidente de hardcoded URLs | Claude AI |

---

**Status**: üü° **Em Implementa√ß√£o** (3/5 camadas ativas)

**Pr√≥xima Revis√£o**: 2025-12-08 (30 dias)

**Respons√°vel**: DevOps Team + Code Reviewers
