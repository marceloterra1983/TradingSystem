---
title: Deployment Guide
sidebar_position: 6
description: Deploying the TP Capital application across environments.
tags:
  - apps
  - tp-capital
  - deployment
owner: DocsOps
lastReviewed: '2025-10-26'
---
## Local Development (Linux/WSL/macOS)

1. **Clone & Install**

   ```bash
   git clone https://github.com/<owner>/TradingSystem.git
   cd TradingSystem/apps/tp-capital
   npm install
   ```

2. **Configure Environment**

   ```bash
   cp .env.example .env
   # Key vars:
   # PORT=4005
   # TIMESCALEDB_HOST=localhost
   # TIMESCALEDB_PORT=5433
   # TIMESCALEDB_DATABASE=APPS-TPCAPITAL
   # TIMESCALEDB_SCHEMA=tp_capital
   # GATEWAY_DATABASE_SCHEMA=telegram_gateway
   # TP_CAPITAL_SIGNALS_CHANNEL_ID=-1001649127710
   ```

3. **Start TimescaleDB**

   ```bash
   docker compose -f infrastructure/docker-compose.yml up timescaledb -d
   ```

4. **Run API**

   ```bash
   npm run dev
   # API available at http://localhost:4005
   ```

5. **Optional â€“ Start Telegram Gateway Stack**

   ```bash
   bash tools/scripts/start-local-telegram-gateway.sh
   # Boots TimescaleDB, Gateway (4006/4010) and TP Capital API
   ```

6. **Verify**

   ```bash
   curl http://localhost:4005/health
   curl http://localhost:4005/signals?limit=1
   psql "postgresql://timescale:pass_timescale@localhost:5433/APPS-TPCAPITAL" -c \
     "SELECT COUNT(*) FROM tp_capital.tp_capital_signals;"
   ```

### Seed Sample Data

```bash
npm run seed
```

> Ensure TimescaleDB is running before seeding (`docker compose ps timescaledb`).

## Automation

### CI/CD Pipeline

- Workflow: `.github/workflows/tp-capital.yml`.
- Triggers: Push to `main`, pull requests targeting `main`.
- Steps: Checkout code, set up Docker Buildx, authenticate to GHCR, build image (`ghcr.io/<owner>/tp-capital-signals:latest` and commit SHA tag), push image, notify deployment channel.

### Production Deployment

1. **Prepare Environment File**

   ```bash
   cd apps/tp-capital/infrastructure
   cp tp-capital-signals.env.example tp-capital-signals.env
   # Edit with production credentials:
   # - TELEGRAM_BOT_TOKEN=<prod-token>
   # - QUESTDB_HTTP_URL=http://questdb:9000 (container port; host UI exposed on 9002)
   # - QUESTDB_ILP_HOST=questdb
   # - QUESTDB_ILP_PORT=9009
   ```

2. **Pull Latest Image**

   ```bash
   docker compose -f docker-compose.prod.yml pull
   ```

3. **Start Services**

   ```bash
   docker compose -f docker-compose.prod.yml up -d
   ```

4. **Verify Deployment**

   ```bash
   curl http://<host>:4005/health
   curl http://<host>:4006/health    # Telegram Gateway
   docker compose -f docker-compose.prod.yml logs -f tp-capital
   psql "postgresql://timescale:***@<host>:5433/APPS-TPCAPITAL" -c "SELECT COUNT(*) FROM tp_capital.tp_capital_signals LIMIT 5;"
   ```

5. **Verify Data Persistence**

   ```bash
   docker volume inspect tp-capital-timescaledb-data
   pg_dump --schema=tp_capital APPS-TPCAPITAL > tp-capital-backup.sql
   ```

### Rollback Procedure

1. **Stop Current Deployment**

   ```bash
   docker compose -f docker-compose.prod.yml down
   ```

2. **Pull Previous Image**

   ```bash
   docker pull ghcr.io/<owner>/tp-capital-signals:<previous-commit-sha>
   docker tag ghcr.io/<owner>/tp-capital-signals:<previous-commit-sha> ghcr.io/<owner>/tp-capital-signals:latest
   ```

3. **Restart Services**

   ```bash
   docker compose -f docker-compose.prod.yml up -d
   ```

4. **Verify Rollback**

   ```bash
   curl http://<host>:4005/health
   docker compose -f docker-compose.prod.yml logs -f
   ```

### Infrastructure as Code

- `docker-compose.yml` for local development.
- `docker-compose.prod.yml` for production deployment.
- Environment templates: `.env.example`, `tp-capital-signals.env.example`.
- Dockerfile: Multi-stage Node.js 20 build, non-root user, health check configured.

### Monitoring Integration

- Prometheus scrapes `http://<host>:4005/metrics` every 15 seconds (metrics: `tpcapital_gateway_messages_processed_total`, `tpcapital_gateway_polling_lag_seconds`, `http_request_duration_seconds`).
- Grafana dashboard: `tools/monitoring/dashboards/tp-capital.json` (panels for ingestion rate, API latency, gateway backlog, Timescale health).
- Alerts: Ingestion latency > 1s p95 for 5 minutes, Timescale connectivity failure, queue backlog > 50, error rate > 5% for 10 minutes.
