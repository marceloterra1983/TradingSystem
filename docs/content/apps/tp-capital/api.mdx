---
title: API Surface
description: TP Capital APIs and references to autogenerated documentation.
tags:
  - apps
  - tp-capital
  - api
owner: DocsOps
lastReviewed: '2025-10-26'
---
## Base URLs

- Development (direct): `http://localhost:3200`
- Docker/dev proxy (Compose exposure): `http://localhost:4005` â†’ forwarded to container port 3200
- Production: `http://<host>:4005`

## REST Endpoints

### GET /signals

- Purpose: Retrieve paginated list of normalized TP Capital signals.
- Query parameters: `channel`, `signal_type`, `limit` (default 50), `offset` (default 0).
- Response:

  ```json
  {
    "data": [
      {
        "id": "abc123",
        "asset": "PETR4",
        "signal_type": "COMPRA",
        "buy_min": 32.5,
        "buy_max": 33.0,
        "targets": [34.0, 35.0, 36.0],
        "stop": 31.5,
        "channel": "TP_Capital",
        "ts": "2025-10-24T10:30:00.000Z"
      }
    ],
    "total": 1234,
    "limit": 100,
    "offset": 0
  }
  ```

- Status codes: `200`, `400`, `503`.
- Example (dev): `curl "http://localhost:3200/signals?channel=TP_Capital&limit=10"`.
- Example (prod): `curl "http://<host>:4005/signals?channel=TP_Capital&limit=10"`.

### GET /logs

- Purpose: Retrieve operational logs.
- Query parameters: `limit`, `level`.
- Example:

  ```bash
  curl "http://localhost:3200/logs?level=error&limit=20"
  # Use http://<host>:4005/... in production.
  ```

### GET /telegram/bots

- Purpose: List registered Telegram bots and metadata.
- Response masks tokens (`token_preview` only).

### GET /telegram/channels

- Purpose: List monitored Telegram channels and groups.
- Includes last signal timestamp and 24h signal count.

### GET /health

- Purpose: Health check (`{"status": "ok", "questdb": "connected"}`).
- Status `503` indicates degraded or unavailable state.

### GET /metrics

- Purpose: Prometheus metrics endpoint.
- Returns text format counters, gauges, histograms (`tp_capital_*` metrics).

## OpenAPI Specification

- Status: Pending publication.
- Planned file: `docs/content/reference/specs/openapi/tp-capital.yaml`.
- Future Redoc locations: `http://localhost:3101/tp-capital` (dev), `https://docs.tradingsystem.local/api/tp-capital` (prod).

## Event Streams

- Current implementation: HTTP polling (15-second interval).
- Planned (v1.1.0): WebSocket endpoint `ws://localhost:3200/ws` (dev) / `wss://<host>:4005/ws` (prod).
- Event contract:

  ```json
  {
    "type": "signal-created",
    "signal": {
      "id": "abc123",
      "asset": "PETR4",
      "signal_type": "COMPRA",
      "buy_min": 32.5,
      "buy_max": 33.0,
      "targets": [34.0, 35.0, 36.0],
      "stop": 31.5,
      "channel": "TP_Capital",
      "ts": "2025-10-24T10:30:00.000Z"
    }
  }
  ```

## Integration Examples

```typescript
interface Signal {
  id: string;
  asset: string;
  signal_type: 'COMPRA' | 'VENDA';
  buy_min?: number;
  buy_max?: number;
  targets: number[];
  stop?: number;
  channel: string;
  ts: string;
}

async function fetchSignals(filters: {
  channel?: string;
  signal_type?: string;
  limit?: number;
  offset?: number;
}): Promise<Signal[]> {
  const params = new URLSearchParams();
  if (filters.channel) params.append('channel', filters.channel);
  if (filters.signal_type) params.append('signal_type', filters.signal_type);
  if (filters.limit) params.append('limit', String(filters.limit));
  if (filters.offset) params.append('offset', String(filters.offset));

  const response = await fetch(`http://localhost:3200/signals?${params.toString()}`);
  // Swap to http://<host>:4005/... when targeting production.
  if (!response.ok) throw new Error(`HTTP error: ${response.status}`);

  const data = await response.json();
  return data.data || [];
}
```

```typescript
import { useQuery } from '@tanstack/react-query';

function useTPCapitalSignals(filters: Record<string, unknown>) {
  return useQuery({
    queryKey: ['tp-capital-signals', filters],
    queryFn: () => fetchSignals(filters),
    staleTime: 10000,
    refetchInterval: 15000,
    keepPreviousData: true,
  });
}
```

## QuestDB Queries

```sql
SELECT * FROM tp_capital_signals
WHERE ts > now() - 7d
ORDER BY ts DESC
LIMIT 100;

SELECT channel, COUNT(*) AS signal_count
FROM tp_capital_signals
WHERE ts > now() - 1d
GROUP BY channel;

SELECT signal_type, COUNT(*) AS count, AVG(targets[1]) AS avg_first_target
FROM tp_capital_signals
WHERE ts > now() - 7d
GROUP BY signal_type;
```

## Rate Limiting

- Not implemented as of v1.0.0.
- Planned limits (v1.1.0): 100 requests/minute per IP, 1000/hour per API key, burst 20 requests.
- Planned headers: `X-RateLimit-Limit`, `X-RateLimit-Remaining`, `X-RateLimit-Reset`.

## Authentication

- Current status: None (internal service).
- Future consideration: API keys for external consumers.

## CORS Configuration

- Allowed origins: `http://localhost:3103`, `http://localhost:3900`, production domains.
- Methods: GET, POST, OPTIONS.
- Headers: Content-Type, Authorization.
