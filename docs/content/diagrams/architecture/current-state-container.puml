@startuml Current State Architecture - Container Diagram
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

LAYOUT_WITH_LEGEND()

title TradingSystem - Current State Architecture (2025-11-02)

Person(user, "User", "Trader/Developer")
Person(admin, "Admin", "System Administrator")

System_Boundary(tradingsystem, "TradingSystem") {
    Container(dashboard, "Dashboard", "React 18 + Vite", "Main UI for trading operations, documentation, and monitoring")
    Container(docs_hub, "Documentation Hub", "Docusaurus v3 + NGINX", "Comprehensive documentation portal with search")

    Container(workspace_api, "Workspace API", "Node.js + Express", "Manages workspace items and categories")
    Container(tp_capital_api, "TP Capital API", "Node.js + Express", "Telegram signal ingestion and processing")
    Container(docs_api, "Documentation API", "Node.js + Express", "Documentation search, FlexSearch, RAG proxy")
    Container(service_launcher, "Service Launcher", "Node.js + Express", "Service orchestration and health checks")
    Container(telegram_gateway, "Telegram Gateway", "Node.js + Express", "MTProto client for Telegram")

    Container(rag_ollama, "Ollama", "LLM Runtime", "Hosts llama3.2:3b for RAG")
    Container(rag_llamaindex_query, "LlamaIndex Query", "FastAPI + Python", "RAG query engine with context retrieval")
    Container(rag_llamaindex_ingest, "LlamaIndex Ingestion", "FastAPI + Python", "Document ingestion and embedding")
    Container(rag_collections, "RAG Collections", "Node.js + Express", "Collection management and batch ingestion")

    ContainerDb(timescaledb, "TimescaleDB", "PostgreSQL + TimescaleDB", "Time-series data, workspace items, signals")
    ContainerDb(qdrant, "Qdrant", "Vector Database", "Document embeddings for semantic search")
    ContainerDb(redis, "Redis", "Cache", "RAG query caching")
}

System_Ext(telegram, "Telegram", "External messaging platform")

Rel(user, dashboard, "Uses", "HTTPS")
Rel(user, docs_hub, "Views docs", "HTTPS")
Rel(admin, service_launcher, "Manages services", "HTTPS")

Rel(dashboard, workspace_api, "CRUD operations", "HTTP/REST")
Rel(dashboard, tp_capital_api, "View signals", "HTTP/REST")
Rel(dashboard, docs_api, "Search docs", "HTTP/REST")
Rel(dashboard, rag_collections, "Manage collections", "HTTP/REST")
Rel(dashboard, service_launcher, "Health checks", "HTTP/REST")

Rel(docs_api, rag_llamaindex_query, "Proxy RAG queries", "HTTP + JWT")
Rel(docs_api, rag_collections, "Collection ops", "HTTP")
Rel(rag_collections, rag_llamaindex_ingest, "Trigger ingestion", "HTTP + JWT")
Rel(rag_llamaindex_query, rag_ollama, "LLM inference", "HTTP")
Rel(rag_llamaindex_ingest, rag_ollama, "Generate embeddings", "HTTP")

Rel(workspace_api, timescaledb, "Read/Write", "PostgreSQL")
Rel(tp_capital_api, timescaledb, "Read/Write", "PostgreSQL")
Rel(docs_api, timescaledb, "Metadata", "PostgreSQL")
Rel(tp_capital_api, telegram_gateway, "Poll messages", "HTTP")

Rel(rag_llamaindex_query, qdrant, "Vector search", "HTTP")
Rel(rag_llamaindex_ingest, qdrant, "Store embeddings", "HTTP")
Rel(rag_collections, redis, "Cache results", "Redis protocol")

Rel(telegram_gateway, telegram, "MTProto", "TCP")

note right of timescaledb
  **Single Point of Failure**
  No replicas, no HA
end note

note right of dashboard
  **Security Gap**
  Direct service access
  No API gateway
end note

note bottom
  **Critical Issues:**
  • No API Gateway - Services trust each other
  • Single DB instance - No HA/DR
  • 5.8% test coverage - Quality risk
  • No inter-service authentication

  **Grade: B+**
end note

@enduml
