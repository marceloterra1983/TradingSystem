---
title: Dev Container - Arquitetura
slug: /tools/dev-container/architecture
sidebar_label: Arquitetura
sidebar_position: 2
tags: [dev-container, docker, architecture, infrastructure]
domain: tools
type: architecture
summary: "Arquitetura detalhada do Dev Container: camadas, redes, volumes, processos e comunica√ß√£o com Docker host"
status: active
last_review: "2025-11-12"
---

# Dev Container - Arquitetura

## üéØ Vis√£o Geral Arquitetural

O Dev Container √© uma **arquitetura em camadas** que combina:
1. **Base Image** - Ubuntu 22.04 LTS
2. **Runtime Layer** - Node.js, Python, Docker CLI
3. **Tools Layer** - Git, Zsh, direnv, etc
4. **VS Code Integration** - VS Code Server + Extensions

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Host System (Windows/Mac/Linux)                        ‚îÇ
‚îÇ  ‚îú‚îÄ> Docker Desktop                                     ‚îÇ
‚îÇ  ‚îú‚îÄ> VS Code (UI)                                       ‚îÇ
‚îÇ  ‚îî‚îÄ> Browser (http://localhost:9082)                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì Docker Remote API
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Dev Container (Docker Container)                       ‚îÇ
‚îÇ  ‚îú‚îÄ> VS Code Server                                     ‚îÇ
‚îÇ  ‚îú‚îÄ> Zsh shell (default)                                ‚îÇ
‚îÇ  ‚îú‚îÄ> Node.js 20 LTS                                     ‚îÇ
‚îÇ  ‚îú‚îÄ> Python 3.12                                        ‚îÇ
‚îÇ  ‚îú‚îÄ> Docker CLI (connected to host daemon)              ‚îÇ
‚îÇ  ‚îî‚îÄ> Git + GitHub CLI                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì Docker socket (/var/run/docker.sock)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Docker Daemon (Host)                                   ‚îÇ
‚îÇ  ‚îú‚îÄ> Traefik Gateway (9082, 9083)                       ‚îÇ
‚îÇ  ‚îú‚îÄ> Dashboard UI (3103)                                ‚îÇ
‚îÇ  ‚îú‚îÄ> Backend APIs (3200, 4005, 4010)                    ‚îÇ
‚îÇ  ‚îú‚îÄ> Databases (PostgreSQL, TimescaleDB, Redis)         ‚îÇ
‚îÇ  ‚îî‚îÄ> Monitoring (Prometheus, Grafana)                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üì¶ Container Layers (Image Build)

### Layer 1: Base Image

**Image:** `mcr.microsoft.com/devcontainers/base:jammy`

**Inclui:**
- ‚úÖ Ubuntu 22.04 LTS (Jammy)
- ‚úÖ Common dev tools (curl, wget, ca-certificates)
- ‚úÖ Non-root user (`vscode`)
- ‚úÖ Sudo access configured

**Dockerfile:**
```dockerfile
FROM mcr.microsoft.com/devcontainers/base:jammy

# Usa usu√°rio root para instala√ß√£o
USER root
```

### Layer 2: System Packages

**Installed via apt:**
```dockerfile
RUN apt-get update && apt-get install -y \
    git \
    curl \
    wget \
    jq \
    ca-certificates \
    gnupg \
    lsb-release \
    build-essential \
    python3-pip \
    python3-venv \
    && rm -rf /var/lib/apt/lists/*
```

**Prop√≥sito:**
- `git` - Controle de vers√£o
- `curl/wget` - Download de arquivos
- `jq` - Processar JSON na linha de comando
- `build-essential` - Compiladores C/C++ (para pacotes nativos npm/pip)
- `python3-pip/venv` - Python package management

### Layer 3: Docker CLI

**Instala√ß√£o:**
```dockerfile
# Adicionar Docker repository
RUN curl -fsSL https://download.docker.com/linux/ubuntu/gpg | gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg

RUN echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | tee /etc/apt/sources.list.d/docker.list > /dev/null

RUN apt-get update && apt-get install -y docker-ce-cli
```

**Importante:**
- ‚ö†Ô∏è **Apenas Docker CLI** √© instalado (n√£o o daemon)
- ‚ö†Ô∏è Docker daemon **roda no host** (Docker Desktop)
- ‚úÖ CLI se conecta via socket mount: `/var/run/docker.sock:/var/run/docker.sock`

### Layer 4: Node.js (via nvm)

**Instala√ß√£o:**
```dockerfile
# Install nvm
RUN curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash

# Install Node.js 20 LTS
RUN bash -c "source ~/.nvm/nvm.sh && nvm install 20 && nvm use 20 && nvm alias default 20"

# Install global packages
RUN npm install -g npm@latest pnpm@latest
```

**Vers√£o:** Node.js 20.x LTS (atualizado automaticamente para √∫ltima minor/patch)

**Pacotes Globais:**
- `npm` - Gerenciador de pacotes (latest)
- `pnpm` - Alternativa r√°pida ao npm

### Layer 5: Python (via pyenv)

**Instala√ß√£o:**
```dockerfile
# Install pyenv dependencies
RUN apt-get update && apt-get install -y \
    make \
    libssl-dev \
    zlib1g-dev \
    libbz2-dev \
    libreadline-dev \
    libsqlite3-dev \
    llvm \
    libncursesw5-dev \
    xz-utils \
    tk-dev \
    libxml2-dev \
    libxmlsec1-dev \
    libffi-dev \
    liblzma-dev

# Install pyenv
RUN curl https://pyenv.run | bash

# Install Python 3.12
RUN bash -c "export PATH=\"$HOME/.pyenv/bin:$PATH\" && eval \"\$(pyenv init -)\" && pyenv install 3.12 && pyenv global 3.12"
```

**Vers√£o:** Python 3.12.x (latest stable)

### Layer 6: Shell (Zsh + Oh My Zsh)

**Instala√ß√£o:**
```dockerfile
# Install Zsh
RUN apt-get install -y zsh

# Install Oh My Zsh
RUN sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended

# Install Powerlevel10k theme
RUN git clone --depth=1 https://github.com/romkatv/powerlevel10k.git ${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/themes/powerlevel10k

# Set Zsh as default shell
RUN chsh -s $(which zsh) vscode
```

**Plugins Habilitados:**
- `git` - Git aliases e prompt info
- `docker` - Docker completion
- `docker-compose` - Docker Compose completion
- `npm` - NPM completion
- `node` - Node.js version in prompt

### Layer 7: Additional Tools

**direnv (Auto-activation):**
```dockerfile
RUN curl -sfL https://direnv.net/install.sh | bash
RUN echo 'eval "$(direnv hook zsh)"' >> ~/.zshrc
```

**GitHub CLI:**
```dockerfile
RUN curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg
RUN echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | tee /etc/apt/sources.list.d/github-cli.list > /dev/null
RUN apt-get update && apt-get install gh -y
```

### Layer 8: VS Code Server

**Instalado automaticamente** pelo VS Code Remote Extension:
- ‚úÖ VS Code Server binary
- ‚úÖ Extensions specified in `devcontainer.json`
- ‚úÖ Settings synchronized

**N√£o precisa configurar manualmente!**

## üåê Network Architecture

### Dev Container Network

O Dev Container est√° conectado a **m√∫ltiplas redes Docker**:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Dev Container                                          ‚îÇ
‚îÇ  ‚îú‚îÄ> eth0: bridge (default Docker network)             ‚îÇ
‚îÇ  ‚îú‚îÄ> tradingsystem_backend (custom network)            ‚îÇ
‚îÇ  ‚îî‚îÄ> tradingsystem_frontend (custom network)           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Configura√ß√£o (`devcontainer.json`):**
```json
{
  "runArgs": [
    "--network=tradingsystem_backend",
    "--network=tradingsystem_frontend"
  ]
}
```

### Network Access Patterns

#### 1. Browser ‚Üí Host Ports (Port Forwarding)

```
Browser ‚Üí http://localhost:9082
         ‚Üì (forwarded by Docker)
Host Port 9082 ‚Üí Container Port 9082 (Traefik Gateway)
```

**Como funciona:**
- Docker Desktop **mapeia portas** do container para o host
- `-p 9082:9080` ‚Üí Porta 9082 no host ‚Üí Porta 9080 no container
- Browser acessa `localhost:9082` (host)

#### 2. Dev Container ‚Üí Docker Containers (Container Networking)

```
Dev Container ‚Üí workspace-api:3200
              ‚Üì (via tradingsystem_backend network)
Workspace API Container (3200)
```

**Como funciona:**
- Containers na **mesma rede** podem se comunicar pelo **nome do servi√ßo**
- DNS interno do Docker resolve `workspace-api` ‚Üí IP do container
- Sem necessidade de `localhost` ou IPs hardcoded

#### 3. Dev Container ‚Üí Docker Daemon (Socket Mount)

```
Dev Container ‚Üí docker ps
              ‚Üì (/var/run/docker.sock mount)
Host Docker Daemon ‚Üí Lista containers do host
```

**Como funciona:**
- Docker socket **montado** do host para o container
- Dev Container CLI **se conecta** ao daemon do host
- Commands executados **afetam o host** (n√£o o container)

## üíæ Volume Mounts

### Workspace Mount (Bind Mount)

```json
{
  "workspaceFolder": "/workspace",
  "workspaceMount": "source=${localWorkspaceFolder},target=/workspace,type=bind"
}
```

**Prop√≥sito:**
- ‚úÖ C√≥digo-fonte sincronizado entre host e container
- ‚úÖ Altera√ß√µes no host **refletem imediatamente** no container
- ‚úÖ Git operations afetam diret√≥rio do host
- ‚úÖ Persist√™ncia de c√≥digo fora do container

**Diret√≥rio:**
- Host: `/home/marce/Projetos/TradingSystem`
- Container: `/workspace`

### Docker Socket Mount (Bind Mount)

```json
{
  "mounts": [
    "source=/var/run/docker.sock,target=/var/run/docker.sock,type=bind"
  ]
}
```

**Prop√≥sito:**
- ‚úÖ Dev Container pode **gerenciar containers do host**
- ‚úÖ `docker compose up/down` afetam host
- ‚úÖ `docker ps` lista containers do host
- ‚ö†Ô∏è **Seguran√ßa:** Container tem acesso privilegiado ao Docker daemon

### Node Modules Cache (Named Volume)

```json
{
  "mounts": [
    "source=tradingsystem-node-modules,target=/workspace/node_modules,type=volume"
  ]
}
```

**Prop√≥sito:**
- ‚úÖ `node_modules` **n√£o sincronizado** com host (performance)
- ‚úÖ Instala√ß√µes npm **persistem** entre rebuilds
- ‚úÖ Evita conflitos com host OS (Windows vs Linux binaries)
- ‚ö†Ô∏è Rebuild do container **preserva** node_modules

**Named Volume:** `tradingsystem-node-modules` (gerenciado pelo Docker)

### Python Virtual Environment (Named Volume)

```json
{
  "mounts": [
    "source=tradingsystem-python-venv,target=/workspace/.venv,type=volume"
  ]
}
```

**Prop√≥sito:**
- ‚úÖ Virtual environment **isolado** do host
- ‚úÖ Pacotes pip **persistem** entre rebuilds
- ‚úÖ direnv ativa automaticamente ao `cd /workspace`

## üîÑ Process Tree

### Init System

**PID 1:** `/bin/sh -c while sleep 1000; do :; done`

**Prop√≥sito:**
- ‚úÖ Container n√£o sai quando shell √© fechado
- ‚úÖ VS Code Server pode reiniciar sem matar container
- ‚úÖ Background processes podem rodar

### VS Code Server

**PID 150-200** (aproximadamente): `node /vscode-server/bin/[version]/server.js`

**Prop√≥sito:**
- ‚úÖ Comunica com VS Code UI (no host)
- ‚úÖ Executa extensions dentro do container
- ‚úÖ Gerencia terminal integrado

### User Shell (Zsh)

**PID varia**: `/bin/zsh` (quando terminal √© aberto)

**Prop√≥sito:**
- ‚úÖ Shell interativo do desenvolvedor
- ‚úÖ Executa commands (`npm`, `docker`, `git`, etc)
- ‚úÖ M√∫ltiplos terminais = m√∫ltiplos processos Zsh

### Docker CLI Calls

**Exemplo:** `docker compose up -d workspace-api`

**Processo:**
1. Zsh shell executa `docker` binary
2. Docker CLI se conecta ao daemon via `/var/run/docker.sock`
3. Daemon (no host) cria container `workspace-api`
4. Container aparece em `docker ps` (executado no host)

**Importante:**
- ‚ö†Ô∏è Docker CLI roda **dentro do Dev Container**
- ‚ö†Ô∏è Docker daemon roda **no host**
- ‚úÖ Resultado: Container criado **no host** (n√£o dentro do Dev Container)

## üîê Security Considerations

### Docker Socket Access (Root Equivalent)

**Risco:**
```bash
# Dentro do Dev Container (com Docker socket)
docker run --rm -v /:/host -it alpine chroot /host /bin/bash
# Agora voc√™ tem shell root no HOST!
```

**Mitiga√ß√£o:**
- ‚úÖ Apenas desenvolvedores confi√°veis t√™m acesso
- ‚úÖ Workspace mount √© read-write (mas isolado)
- ‚úÖ Container roda como non-root user (`vscode`)
- ‚ö†Ô∏è Docker socket √© **necess√°rio** para gerenciar services

**Pol√≠tica:** Ver [Security Guide](../../governance/controls/dev-container-security.md)

### Non-Root User

**Default User:** `vscode` (UID 1000, GID 1000)

```json
{
  "remoteUser": "vscode"
}
```

**Prop√≥sito:**
- ‚úÖ Evita criar arquivos como root no host
- ‚úÖ Permiss√µes corretas em workspace mount
- ‚úÖ Sudo dispon√≠vel para instala√ß√µes (`sudo apt-get install`)

### Environment Variables (.env)

**Onde est√°:**
- Host: `/home/marce/Projetos/TradingSystem/.env`
- Container: `/workspace/.env` (bind mount)

**Acesso:**
- ‚úÖ Dev Container pode **ler** `.env`
- ‚úÖ Vite/Node.js **carregam** vari√°veis automaticamente
- ‚ö†Ô∏è `.env` **N√ÉO deve ser commitado** (cont√©m secrets)

**Valida√ß√£o:**
```bash
# Dentro do Dev Container
bash scripts/env/validate-env.sh
```

## üìä Resource Limits

### Default Limits (Docker Desktop)

**Nenhum limite espec√≠fico configurado.**

Docker Desktop usa configura√ß√£o global:
- **CPU:** Todos os cores dispon√≠veis
- **Memory:** At√© limite configurado em Docker Desktop Settings
- **Disk:** At√© limite de VM do Docker Desktop

### Monitoring

```bash
# Ver uso de recursos do Dev Container
docker stats tradingsystem-dev-container

# Ver todos os containers (incluindo Dev Container)
docker stats
```

**Output esperado:**
```
CONTAINER              CPU %  MEM USAGE / LIMIT    MEM %  NET I/O        BLOCK I/O
tradingsystem-dev      2.5%   500MiB / 8GiB        6.25%  10MB / 5MB     100MB / 50MB
```

## üîß Rebuild Scenarios

### Quando fazer Rebuild?

**Rebuild necess√°rio:**
- ‚úÖ Atualizar Node.js/Python version
- ‚úÖ Adicionar system packages (`apt-get install`)
- ‚úÖ Modificar Dockerfile
- ‚úÖ Atualizar base image
- ‚úÖ Adicionar VS Code extensions
- ‚úÖ Modificar `devcontainer.json` (alguns campos)

**Rebuild N√ÉO necess√°rio:**
- ‚ùå Atualizar c√≥digo-fonte (workspace mount)
- ‚ùå Instalar npm packages (`npm install`)
- ‚ùå Instalar pip packages (`pip install`)
- ‚ùå Modificar `.env` (bind mount)

### Como fazer Rebuild?

**VS Code Command Palette:**
```
Ctrl+Shift+P ‚Üí Dev Containers: Rebuild Container
```

**Op√ß√µes:**
1. **Rebuild** - Rebuild image e recriar container
2. **Rebuild Without Cache** - Rebuild do zero (lento, mas clean)

**Tempo esperado:**
- Rebuild normal: ~2-5 minutos
- Rebuild sem cache: ~10-15 minutos

## üìà Performance Considerations

### File System Performance

**Bind Mount (Workspace):**
- ‚ö†Ô∏è Mais lento que volumes nativos (especialmente Windows/Mac)
- ‚úÖ Necess√°rio para sincroniza√ß√£o de c√≥digo
- ‚úÖ Git operations diretas no host

**Named Volumes (node_modules, .venv):**
- ‚úÖ Performance nativa (dentro do Docker)
- ‚úÖ Evita overhead de sincroniza√ß√£o
- ‚úÖ Recomendado para depend√™ncias

### Build Performance

**Layer Caching:**
- ‚úÖ Docker cacheia layers que n√£o mudaram
- ‚úÖ Modifica√ß√µes em layers superiores n√£o invalidam inferiores
- ‚úÖ Ordem otimizada (base ‚Üí runtimes ‚Üí tools)

**Multi-stage Builds:**
- ‚ùå N√£o usado (Dev Container √© single-stage)
- ‚úÖ N√£o necess√°rio (n√£o √© produ√ß√£o)

### Runtime Performance

**CPU:**
- ‚úÖ Native performance (container n√£o virtualiza CPU)
- ‚úÖ Node.js/Python rodam na mesma velocidade do host

**Memory:**
- ‚úÖ Container usa mem√≥ria do host diretamente
- ‚ö†Ô∏è M√∫ltiplos containers + Dev Container = alto uso de RAM

**Disk I/O:**
- ‚úÖ Volumes nativos (node_modules) = r√°pido
- ‚ö†Ô∏è Bind mounts (workspace) = lento em Windows/Mac (WSL2 ajuda)

## üé® PlantUML Diagrams

### Dev Container Architecture

```plantuml
@startuml dev-container-architecture
!theme blueprint
title Dev Container - Arquitetura Completa

' Container Layers
package "Dev Container" {
  [VS Code Server] as vscode
  [Zsh + Oh My Zsh] as shell
  [Node.js 20 LTS] as node
  [Python 3.12] as python
  [Docker CLI] as docker_cli
  [Git] as git
  [GitHub CLI] as gh
}

package "Docker-in-Docker (Host)" {
  [Docker Daemon] as daemon
  [Traefik Gateway] as traefik
  [Workspace Stack] as workspace
  [Telegram Stack] as telegram
  [TP Capital Stack] as tp
  [Docs Stack] as docs
}

package "Host System" {
  [Docker Desktop] as docker_desktop
  [Browser] as browser
  [VS Code] as vscode_host
}

' Connections
vscode_host --> vscode : Remote Extension
vscode --> docker_cli : Execute docker commands
docker_cli --> daemon : /var/run/docker.sock
daemon --> traefik
daemon --> workspace
daemon --> telegram
daemon --> tp
daemon --> docs
browser --> traefik : http://localhost:9082

@enduml
```

:::note
Os renders em PNG s√£o gerados automaticamente a partir dos arquivos `.puml` durante o fluxo `npm run docs:auto`. Execute esse comando sempre que atualizar os diagramas para repopular `docs/content/diagrams/rendered/tools/` antes de rodar `npm run docs:links`.
:::

**Diagrama Fonte:** [dev-container-architecture.puml](https://github.com/marceloterra1983/TradingSystem/blob/main/docs/content/diagrams/source/tools/dev-container-architecture.puml)

### Network Topology

```plantuml
@startuml dev-container-network
!theme blueprint
title Dev Container - Topologia de Redes

' Networks
cloud "Host Network" {
  [Browser] : Port 9082
}

node "Dev Container Network" {
  [Vite Dev Server] : Port 5173
  [VS Code Server] : Port 8080
}

cloud "Docker Networks" {
  node "tradingsystem_backend" {
    [workspace-api]
    [tp-capital-api]
    [telegram-api]
  }

  node "tradingsystem_frontend" {
    [Traefik Gateway] : Port 9082
    [docs-hub]
  }
}

' Connections
[Browser] --> [Traefik Gateway] : http://localhost:9082
[Vite Dev Server] --> [workspace-api] : Proxy
[Vite Dev Server] --> [Traefik Gateway] : Proxy
[Traefik Gateway] --> [workspace-api] : Route
[Traefik Gateway] --> [tp-capital-api] : Route
[Traefik Gateway] --> [telegram-api] : Route

@enduml
```

:::note
Os renders em PNG s√£o gerados automaticamente a partir dos arquivos `.puml` durante o fluxo `npm run docs:auto`. Execute esse comando sempre que atualizar os diagramas para repopular `docs/content/diagrams/rendered/tools/` antes de rodar `npm run docs:links`.
:::

**Diagrama Fonte:** [dev-container-network.puml](https://github.com/marceloterra1983/TradingSystem/blob/main/docs/content/diagrams/source/tools/dev-container-network.puml)

## üìñ Documenta√ß√£o Relacionada

### Guias Complementares

- **[Overview](overview.mdx)** - Vis√£o geral do Dev Container
- **[API Access Patterns](api-access.mdx)** - Como acessar APIs
- **[Gateway & Proxy](gateway-proxy.mdx)** - Traefik e Vite Proxy
- **[Workflows](workflows.mdx)** - Fluxo de trabalho di√°rio
- **[Troubleshooting](troubleshooting.mdx)** - Problemas comuns

### Governan√ßa

- **[Dev Container Policy](../../governance/policies/dev-container-policy.md)** - Pol√≠ticas de uso
- **[Security Guide](../../governance/controls/dev-container-security.md)** - Seguran√ßa

### Refer√™ncias

- **[devcontainer.json](https://github.com/marceloterra1983/TradingSystem/blob/main/.devcontainer/devcontainer.json)** - Configura√ß√£o
- **[Dockerfile](https://github.com/marceloterra1983/TradingSystem/blob/main/.devcontainer/Dockerfile)** - Image build
- **[CLAUDE.md](https://github.com/marceloterra1983/TradingSystem/blob/main/CLAUDE.md)** - Instru√ß√µes gerais

## ‚ùì FAQ T√©cnico

### Por que usar nvm/pyenv em vez de instalar direto?

**Vantagens:**
- ‚úÖ M√∫ltiplas vers√µes (futuro: Node.js 22, Python 3.13)
- ‚úÖ F√°cil upgrade (`nvm install 22 && nvm use 22`)
- ‚úÖ N√£o polui system PATH
- ‚úÖ Isolamento de pacotes globais

### Por que node_modules em volume separado?

**Raz√µes:**
1. **Performance**: Volumes nativos s√£o ~10x mais r√°pidos que bind mounts
2. **Compatibilidade**: Bin√°rios compilados (Linux no container vs Windows/Mac no host)
3. **Tamanho**: node_modules pode ter 500MB+ (lento para sincronizar)

### Posso usar Docker Compose dentro do Dev Container?

**Sim!** √â exatamente para isso que o Docker socket est√° montado.

```bash
# Dentro do Dev Container
cd tools/compose
docker compose -f docker-compose.0-gateway-stack.yml up -d
# Containers criados NO HOST (n√£o dentro do Dev Container)
```

### Como funciona direnv?

**Auto-activation:**
```bash
# Quando voc√™ faz cd /workspace
cd /workspace
# direnv detecta .envrc e carrega vari√°veis + ativa venv Python
direnv: loading /workspace/.envrc
(venv) ‚ûú  workspace git:(main) ‚úó
```

**Manual reload:**
```bash
direnv reload
```

### Como adicionar uma VS Code extension?

**Editar `.devcontainer/devcontainer.json`:**
```json
{
  "customizations": {
    "vscode": {
      "extensions": [
        "esbenp.prettier-vscode",
        "dbaeumer.vscode-eslint",
        "ms-python.python",
        // Adicionar aqui
        "bradlc.vscode-tailwindcss"
      ]
    }
  }
}
```

**Rebuild container:**
```
Ctrl+Shift+P ‚Üí Dev Containers: Rebuild Container
```

---

**√öltima revis√£o:** 2025-11-12
**Status:** ‚úÖ Ativo
**Pr√≥xima revis√£o:** 2026-02-12 (3 meses)
