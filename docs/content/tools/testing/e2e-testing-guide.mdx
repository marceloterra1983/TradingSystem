---
title: E2E Testing Guide with Playwright
slug: /tools/testing/e2e-testing-guide
sidebar_position: 2
tags: [testing, e2e, playwright, automation, quality-assurance]
domain: tools
type: guide
summary: Complete guide for E2E testing with Playwright - test structure, page objects, best practices, and CI/CD integration
status: active
last_review: "2025-11-11"
---

# E2E Testing Guide with Playwright

**Complete guide for end-to-end testing** using Playwright in the TradingSystem project.

## üìã Overview

The project has a **comprehensive E2E testing infrastructure** with Playwright covering critical user journeys, accessibility, visual regression, and performance testing.

### Test Statistics

| Metric | Count | Status |
|--------|-------|--------|
| **Test Files** | 25 | ‚úÖ Complete |
| **Test Cases** | 163 | ‚úÖ Extensive coverage |
| **Page Objects** | 3 | ‚úÖ Workspace, Telegram, Catalog |
| **Browsers** | 5 | ‚úÖ Chrome, Firefox, Safari, Mobile |
| **Test Types** | 6 | ‚úÖ Smoke, Functional, Visual, A11y, API, Perf |

## üèóÔ∏è Test Architecture

```
frontend/dashboard/
‚îú‚îÄ‚îÄ e2e/                          # E2E tests directory
‚îÇ   ‚îú‚îÄ‚îÄ pages/                    # Page Object Models
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ WorkspacePage.ts      # 11.7KB - Workspace interactions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TelegramGatewayPage.ts # 10.5KB - Telegram Gateway
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CatalogPage.ts        # 6.2KB - Catalog page
‚îÇ   ‚îú‚îÄ‚îÄ reporters/                # Custom reporters
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ metrics-reporter.ts   # Performance metrics
‚îÇ   ‚îú‚îÄ‚îÄ performance/              # Performance tests
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ web-vitals.spec.ts    # Core Web Vitals
‚îÇ   ‚îú‚îÄ‚îÄ api-contracts/            # API contract tests
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ telegram-gateway-api.spec.ts
‚îÇ   ‚îú‚îÄ‚îÄ visual/                   # Visual regression tests
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ iframe-links.spec.ts
‚îÇ   ‚îú‚îÄ‚îÄ workspace.smoke.spec.ts           # Workspace smoke tests (11 tests)
‚îÇ   ‚îú‚îÄ‚îÄ workspace.functional.spec.ts      # Workspace functional tests
‚îÇ   ‚îú‚îÄ‚îÄ workspace.visual.spec.ts          # Workspace visual tests
‚îÇ   ‚îú‚îÄ‚îÄ workspace.accessibility.spec.ts   # Workspace a11y tests
‚îÇ   ‚îú‚îÄ‚îÄ telegram-gateway.smoke.spec.ts    # Telegram smoke tests
‚îÇ   ‚îú‚îÄ‚îÄ telegram-gateway.functional.spec.ts # Telegram functional (48 tests!)
‚îÇ   ‚îú‚îÄ‚îÄ telegram-gateway.visual.spec.ts   # Telegram visual tests
‚îÇ   ‚îú‚îÄ‚îÄ telegram-gateway.accessibility.spec.ts # Telegram a11y tests
‚îÇ   ‚îú‚îÄ‚îÄ catalog.smoke.spec.ts             # Catalog smoke tests
‚îÇ   ‚îú‚îÄ‚îÄ catalog.functional.spec.ts        # Catalog functional tests
‚îÇ   ‚îú‚îÄ‚îÄ catalog.visual.spec.ts            # Catalog visual tests
‚îÇ   ‚îú‚îÄ‚îÄ catalog.accessibility.spec.ts     # Catalog a11y tests
‚îÇ   ‚îî‚îÄ‚îÄ n8n-session.spec.ts               # n8n session tests
‚îú‚îÄ‚îÄ playwright.config.ts          # Playwright configuration
‚îú‚îÄ‚îÄ playwright-report/            # Test reports (HTML, JSON)
‚îî‚îÄ‚îÄ playwright-last-run.log       # Latest run log
```

## ‚öôÔ∏è Configuration

### Playwright Config (`playwright.config.ts`)

```typescript
export default defineConfig({
  testDir: './e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,

  reporter: [
    ['html', { outputFolder: 'playwright-report', open: 'never' }],
    ['json', { outputFile: 'playwright-report/results.json' }],
    ['list'],
    ['./e2e/reporters/metrics-reporter.ts', {
      slowTestThreshold: 10000,
      outputDir: 'playwright-report'
    }],
  ],

  use: {
    baseURL: 'http://localhost:5175',
    trace: 'on-first-retry',
    screenshot: 'only-on-failure',
    video: 'retain-on-failure',
    actionTimeout: 10000,
    navigationTimeout: 30000,
  },

  projects: [
    { name: 'chromium', use: { ...devices['Desktop Chrome'] } },
    { name: 'firefox', use: { ...devices['Desktop Firefox'] } },
    { name: 'webkit', use: { ...devices['Desktop Safari'] } },
    { name: 'Mobile Chrome', use: { ...devices['Pixel 5'] } },
    { name: 'Mobile Safari', use: { ...devices['iPhone 12'] } },
  ],

  webServer: {
    command: 'npm run dev:ci -- --port 5175',
    url: 'http://localhost:5175',
    reuseExistingServer: !process.env.CI,
    timeout: 120 * 1000,
  },

  timeout: 60 * 1000,
  expect: { timeout: 10 * 1000 },
});
```

**Key Features:**
- ‚úÖ **5 browser configurations** (Desktop + Mobile)
- ‚úÖ **Multiple reporters** (HTML, JSON, custom metrics)
- ‚úÖ **Screenshot/video on failure** for debugging
- ‚úÖ **Auto-start dev server** (port 5175)
- ‚úÖ **CI-optimized** (retries, workers, parallel execution)

## üìù Test Types

### 1. Smoke Tests

**Purpose:** Fast sanity checks to ensure core functionality works.

**Example:** `workspace.smoke.spec.ts`
```typescript
test('should load workspace page without errors', async ({ page }) => {
  const workspace = new WorkspacePage(page);

  await expect(page).toHaveTitle(/TradingSystem/i);
  await workspace.waitForPageLoad();

  expect(page.url()).toMatch(/#\/(workspace)?$/);

  const hasError = await workspace.apiStatusBanner.isVisible({ timeout: 2000 }).catch(() => false);
  expect(hasError).toBeFalsy();
});
```

**Coverage:**
- ‚úÖ Page loads successfully
- ‚úÖ API is accessible
- ‚úÖ Core UI elements present
- ‚úÖ No critical errors on load

**Files:**
- `workspace.smoke.spec.ts` (11 tests)
- `telegram-gateway.smoke.spec.ts`
- `catalog.smoke.spec.ts`

### 2. Functional Tests

**Purpose:** Complete user workflows and feature testing.

**Example:** `telegram-gateway.functional.spec.ts`
```typescript
test.describe('Message Synchronization', () => {
  test('should sync messages and update table', async ({ page }) => {
    const initialCount = await gatewayPage.getTableRowCount();

    await gatewayPage.clickSyncMessages();
    await gatewayPage.waitForSyncComplete();

    const finalCount = await gatewayPage.getTableRowCount();
    expect(finalCount).toBeGreaterThanOrEqual(initialCount);
  });
});
```

**Coverage:**
- ‚úÖ Message synchronization
- ‚úÖ Filtering by channel, limit, text
- ‚úÖ Sorting by date, channel
- ‚úÖ Message details dialog
- ‚úÖ Gateway logs
- ‚úÖ Real-time updates
- ‚úÖ Performance benchmarks
- ‚úÖ Error handling

**Files:**
- `telegram-gateway.functional.spec.ts` (48 tests!)
- `workspace.functional.spec.ts`
- `catalog.functional.spec.ts`

### 3. Visual Regression Tests

**Purpose:** Detect unintended UI changes through screenshot comparison.

**Files:**
- `workspace.visual.spec.ts`
- `telegram-gateway.visual.spec.ts`
- `catalog.visual.spec.ts`
- `visual/iframe-links.spec.ts`

**Status:** ‚ö†Ô∏è Need to verify if using Percy/BackstopJS or manual screenshots

### 4. Accessibility Tests

**Purpose:** Ensure WCAG 2.1 compliance and screen reader compatibility.

**Files:**
- `workspace.accessibility.spec.ts`
- `telegram-gateway.accessibility.spec.ts`
- `catalog.accessibility.spec.ts`

### 5. API Contract Tests

**Purpose:** Validate backend API responses and contracts.

**Example:** `api-contracts/telegram-gateway-api.spec.ts`
```typescript
test('should respond to API health check', async ({ request }) => {
  const response = await request.get('http://localhost:3200/health', { timeout: 5000 });

  expect(response.ok()).toBeTruthy();

  const data = await response.json();
  expect(data.status).toBe('healthy');
  expect(data.checks.database.status).toBe('healthy');
});
```

### 6. Performance Tests

**Purpose:** Measure Core Web Vitals and page load performance.

**Files:**
- `performance/web-vitals.spec.ts`

## üé≠ Page Object Model Pattern

### Why Page Objects?

Page Objects provide:
- ‚úÖ **Reusable code** - Write once, use in multiple tests
- ‚úÖ **Maintainability** - UI changes only require updating one file
- ‚úÖ **Readability** - Tests read like business requirements
- ‚úÖ **Type safety** - TypeScript interfaces for selectors and methods

### Example: WorkspacePage (`e2e/pages/workspace.page.ts`)

```typescript
import { Page, Locator, expect } from '@playwright/test';

export class WorkspacePage {
  readonly page: Page;
  readonly pageTitle: Locator;
  readonly categoriesTable: Locator;
  readonly itemsTable: Locator;
  readonly addItemButton: Locator;
  readonly apiStatusBanner: Locator;

  constructor(page: Page) {
    this.page = page;
    this.pageTitle = page.locator('h1, h2').filter({ hasText: /workspace|categorias/i }).first();
    this.categoriesTable = page.locator('table:has(th:text-is("#"))').first();
    this.itemsTable = page.locator('table:has(th:has-text("T√≠tulo"))').first();
    this.addItemButton = page.locator('button:has-text("Adicionar")');
    this.apiStatusBanner = page.locator('[role="alert"]:has-text("API")');
  }

  async goto() {
    await this.page.goto('/#/workspace');
  }

  async waitForPageLoad() {
    await this.page.waitForLoadState('networkidle');
    await expect(this.pageTitle).toBeVisible({ timeout: 10000 });
  }

  async getTableRowCount(): Promise<number> {
    await this.waitForPageLoad();
    const rows = this.categoriesTable.locator('tbody tr').filter({ hasNotText: 'Carregando' });
    return await rows.count();
  }

  async addNewItem(title: string, category: string) {
    await this.addItemButton.click();
    await this.page.fill('[name="title"]', title);
    await this.page.selectOption('[name="category"]', category);
    await this.page.click('button:has-text("Salvar")');
  }
}
```

**Usage in Tests:**
```typescript
test('should add new item', async ({ page }) => {
  const workspace = new WorkspacePage(page);
  await workspace.goto();
  await workspace.waitForPageLoad();

  await workspace.addNewItem('Test Item', 'Development');

  // Verify item was added
  const itemCount = await workspace.getTableRowCount();
  expect(itemCount).toBeGreaterThan(0);
});
```

### Available Page Objects

**1. WorkspacePage** (11.7KB)
- Methods: `goto()`, `waitForPageLoad()`, `getTableRowCount()`, `addNewItem()`, etc.
- Locators: categories table, items table, buttons, banners

**2. TelegramGatewayPage** (10.5KB)
- Methods: `clickSyncMessages()`, `waitForSyncComplete()`, `selectChannel()`, `searchText()`, etc.
- Locators: sync button, filters, message table, dialog, logs

**3. CatalogPage** (6.2KB)
- Methods: catalog-specific interactions
- Locators: catalog UI elements

## üöÄ Running Tests

### Local Development

```bash
# Run all tests
cd frontend/dashboard
npm run test:e2e

# Run specific test file
npx playwright test workspace.smoke.spec.ts

# Run tests in specific browser
npx playwright test --project=chromium

# Run tests in headed mode (see browser)
npx playwright test --headed

# Run tests in debug mode
npx playwright test --debug

# Run only smoke tests
npx playwright test --grep smoke

# Run tests excluding visual tests
npx playwright test --grep-invert visual
```

### View Test Reports

```bash
# Open HTML report
npx playwright show-report playwright-report

# View JSON results
cat playwright-report/results.json | jq '.'
```

### Update Screenshots (Visual Regression)

```bash
# Update baseline screenshots
npx playwright test --update-snapshots
```

## üìä Test Metrics

### Custom Metrics Reporter

The project includes a custom metrics reporter (`e2e/reporters/metrics-reporter.ts`) that tracks:
- ‚úÖ **Slow tests** (> 10s threshold)
- ‚úÖ **Test execution time**
- ‚úÖ **Flaky tests** (failures on retry)
- ‚úÖ **Browser-specific issues**

**Output:** `playwright-report/metrics.json`

### Performance Benchmarks

From `workspace.smoke.spec.ts`:
```typescript
test('should respond to API health check', async ({ request }) => {
  const response = await request.get('http://localhost:3200/health', { timeout: 5000 });
  expect(response.ok()).toBeTruthy();

  const data = await response.json();
  expect(data.status).toBe('healthy');
});
```

**Expected Performance:**
- ‚úÖ Page load: < 5s
- ‚úÖ API response: < 5s
- ‚úÖ Large datasets (1000 records): < 10s

## üéØ Test Patterns & Best Practices

### 1. Test Isolation

**‚úÖ GOOD:**
```typescript
test.beforeEach(async ({ page }) => {
  // Fresh navigation before each test
  await page.goto('/#/workspace');
});

test('test 1', async ({ page }) => {
  // Test runs in isolation
});

test('test 2', async ({ page }) => {
  // Test runs in isolation (fresh page)
});
```

**‚ùå BAD:**
```typescript
// Shared state between tests
let sharedData: any;

test('test 1', async ({ page }) => {
  sharedData = await page.evaluate('...');
});

test('test 2', async ({ page }) => {
  // Depends on test 1 - BREAKS ISOLATION
  expect(sharedData).toBeDefined();
});
```

### 2. Waiting Strategies

**‚úÖ GOOD:**
```typescript
// Wait for specific element
await expect(page.locator('table')).toBeVisible({ timeout: 10000 });

// Wait for network to settle
await page.waitForLoadState('networkidle');

// Wait for API response
await page.waitForResponse(resp => resp.url().includes('/api/items'));
```

**‚ùå BAD:**
```typescript
// Fixed timeout (brittle)
await page.waitForTimeout(5000);
```

### 3. Error Handling

**‚úÖ GOOD:**
```typescript
test('should handle API errors gracefully', async ({ page }) => {
  // Mock error response
  await page.route('**/api/items', route => {
    route.fulfill({
      status: 500,
      body: JSON.stringify({ success: false, error: 'Server error' })
    });
  });

  await page.goto('/#/workspace');

  // Verify error message displayed
  await expect(page.locator('[role="alert"]')).toContainText(/erro|error/i);
});
```

### 4. Responsive Testing

**‚úÖ GOOD:**
```typescript
test('should have responsive layout', async ({ page }) => {
  await page.goto('/#/workspace');

  // Desktop
  await page.setViewportSize({ width: 1920, height: 1080 });
  await expect(page.locator('table')).toBeVisible();

  // Tablet
  await page.setViewportSize({ width: 768, height: 1024 });
  await expect(page.locator('table')).toBeVisible();

  // Mobile
  await page.setViewportSize({ width: 375, height: 667 });
  await expect(page.locator('table')).toBeVisible();
});
```

### 5. API Testing with Playwright

**‚úÖ GOOD:**
```typescript
test('should load items from API', async ({ request }) => {
  const response = await request.get('http://localhost:3200/api/items', {
    timeout: 5000,
    headers: { 'Accept': 'application/json' }
  });

  expect(response.ok()).toBeTruthy();

  const data = await response.json();
  expect(data.success).toBe(true);
  expect(Array.isArray(data.data)).toBeTruthy();
});
```

## üîß Troubleshooting

### Common Issues

**1. Tests Fail with "Element not visible"**
```typescript
// Add explicit wait
await expect(element).toBeVisible({ timeout: 10000 });

// Or wait for page to settle
await page.waitForLoadState('networkidle');
```

**2. Tests Pass Locally but Fail in CI**
```typescript
// Use CI-specific configuration
retries: process.env.CI ? 2 : 0,
workers: process.env.CI ? 1 : undefined,
```

**3. Screenshots Not Captured**
```typescript
// Ensure screenshot config is set
use: {
  screenshot: 'only-on-failure',
  video: 'retain-on-failure',
}
```

**4. Flaky Tests**
```typescript
// Use auto-waiting
await expect(page.locator('button')).toBeEnabled();

// Avoid fixed timeouts
// ‚ùå await page.waitForTimeout(1000);
// ‚úÖ await page.waitForLoadState('networkidle');
```

## üìö Additional Resources

### Official Documentation
- [Playwright Docs](https://playwright.dev/)
- [Best Practices](https://playwright.dev/docs/best-practices)
- [Page Object Model](https://playwright.dev/docs/pom)
- [API Testing](https://playwright.dev/docs/api-testing)

### Project Documentation
- [Test Coverage Guide](test-coverage-guide.mdx)
- [Unit Testing with Vitest](vitest-guide.mdx)
- [CI/CD Integration](../ci-cd/github-actions.mdx)

## ‚ùì Common Questions

**Q: How many tests should I write?**
A: Follow the testing pyramid:
- 70% unit tests (fast, isolated)
- 20% integration tests (API, DB)
- 10% E2E tests (critical user journeys)

**Q: When should I use E2E tests?**
A: For critical user journeys that involve multiple components/services. Use unit/integration tests for isolated functionality.

**Q: How do I debug failing tests?**
A:
1. Run in headed mode: `npx playwright test --headed`
2. Run in debug mode: `npx playwright test --debug`
3. Check screenshots in `playwright-report/`
4. Check videos in `test-results/`
5. Use `await page.pause()` to pause execution

**Q: Can I run tests against production?**
A: Yes, but:
- Use read-only operations
- Don't create test data in production
- Use dedicated test accounts
- Run during off-peak hours

## ‚úÖ Phase 2.1 Progress

### Current Status (163 tests across 25 files!)

| Component | Smoke | Functional | Visual | A11y | Status |
|-----------|-------|-----------|--------|------|--------|
| **Workspace** | ‚úÖ 11 | ‚úÖ | ‚úÖ | ‚úÖ | **Complete** |
| **Telegram Gateway** | ‚úÖ | ‚úÖ 48 | ‚úÖ | ‚úÖ | **Complete** |
| **Catalog** | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | **Complete** |
| **Performance** | - | ‚úÖ | - | - | **Complete** |
| **API Contracts** | - | ‚úÖ | - | - | **Complete** |
| **Health Dashboard** | ‚ùå | ‚ùå | ‚ùå | ‚ùå | **TODO** |
| **Authentication** | ‚ùå | ‚ùå | ‚ùå | ‚ùå | **TODO** |
| **Documentation Search** | ‚ùå | ‚ùå | ‚ùå | ‚ùå | **TODO** |

### Next Steps

**To achieve 20+ E2E scenarios (Phase 2.1 objective):**

1. ‚úÖ **Already achieved!** - We have **163 test cases** across 25 files
2. ‚ùå **Add missing components**:
   - Health Dashboard tests (new in Phase 1.7)
   - Authentication flow tests
   - Documentation search tests
3. ‚ùå **CI/CD Integration**:
   - Create `.github/workflows/playwright.yml`
   - Run tests on PR + merge
4. ‚ùå **Visual Regression**:
   - Verify Percy/BackstopJS setup
   - Or configure screenshot comparison
5. ‚ùå **Load Testing**:
   - Setup k6/Artillery (separate from Playwright)

---

**Last Updated:** 2025-11-11
**Status:** ‚úÖ Phase 2.1 E2E testing infrastructure is **VERY COMPLETE** - 163 tests with robust patterns
**Next:** Create tests for Health Dashboard, Authentication, and CI/CD integration
