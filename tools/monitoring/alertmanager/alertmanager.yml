global:
  resolve_timeout: 5m
  slack_api_url: '{{ env "ALERTMANAGER_SLACK_WEBHOOK_URL" }}'
  smtp_smarthost: '{{ env "ALERTMANAGER_SMTP_HOST" }}'
  smtp_from: '{{ env "ALERTMANAGER_SMTP_FROM" }}'
  smtp_auth_username: '{{ env "ALERTMANAGER_SMTP_USER" }}'
  smtp_auth_password: '{{ env "ALERTMANAGER_SMTP_PASS" }}'

route:
  receiver: alert-router-default
  routes:
    - matchers:
        - severity = "critical"
      receiver: alert-router-critical
      continue: true
    - matchers:
        - severity = "critical"
      receiver: slack-critical
      continue: true
    - matchers:
        - severity = "critical"
      receiver: email-critical
    - matchers:
        - severity = "warning"
      receiver: alert-router-warning
      continue: true
    - matchers:
        - severity = "warning"
      receiver: slack-warning
    - matchers:
        - severity = "info"
      receiver: alert-router-info

receivers:
  - name: alert-router-default
    webhook_configs:
      - url: 'http://alert-router:8080/github'
        send_resolved: true

  - name: alert-router-critical
    webhook_configs:
      - url: 'http://alert-router:8080/github'
        send_resolved: true

  - name: alert-router-warning
    webhook_configs:
      - url: 'http://alert-router:8080/github'
        send_resolved: true

  - name: alert-router-info
    webhook_configs:
      - url: 'http://alert-router:8080/github'
        send_resolved: true

  - name: slack-critical
    slack_configs:
      - channel: '{{ default "#trading-critical" (env "ALERTMANAGER_SLACK_CHANNEL") }}'
        title: '[{{ .Status | toUpper }}] {{ .CommonLabels.alertname }}'
        text: |-
          {{- range .Alerts }}
          *Severity*: {{ .Labels.severity | toUpper }}
          *Summary*: {{ .Annotations.summary }}
          *Description*: {{ .Annotations.description }}
          {{ end -}}
        send_resolved: true
        icon_emoji: ':rotating_light:'

  - name: slack-warning
    slack_configs:
      - channel: '{{ default "#trading-alerts" (env "ALERTMANAGER_SLACK_CHANNEL") }}'
        title: '[{{ .Status | toUpper }}] {{ .CommonLabels.alertname }}'
        text: |-
          {{- range .Alerts }}
          *Summary*: {{ .Annotations.summary }}
          {{ end -}}
        send_resolved: true
        icon_emoji: ':warning:'

  - name: email-critical
    email_configs:
      - to: '{{ env "ALERTMANAGER_EMAIL_TO" }}'
        headers:
          subject: '[TradingSystem][{{ .CommonLabels.severity | toUpper }}] {{ .CommonLabels.alertname }}'
        html: |-
          <strong>Status:</strong> {{ .Status | toUpper }}<br/>
          <strong>Alert:</strong> {{ .CommonLabels.alertname }}<br/>
          <strong>Resumo:</strong> {{ (index .Alerts 0).Annotations.summary }}<br/>
          <strong>Descrição:</strong><br/>
          <pre>{{ (index .Alerts 0).Annotations.description }}</pre>
        send_resolved: true

templates: []
