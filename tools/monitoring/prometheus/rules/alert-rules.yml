groups:
  - name: service-health
    rules:
      - alert: IdeaBankApiDown
        expr: up{job="idea-bank-api"} == 0
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: Idea Bank API is down
          description: 'Prometheus target idea-bank-api has not responded for 2 minutes.'

      - alert: DocsApiErrors
        expr: rate(tradingsystem_http_requests_total{service="docs-api", status_code=~"5.."}[5m]) > 0.5
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: High 5xx error rate in Documentation API
          description: 'High number of 5xx responses observed over the last 5 minutes for docs-api.'

  - name: infrastructure
    rules:
      - alert: NodeExporterDown
        expr: up{job="node-exporter"} == 0
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: Node exporter is unreachable
          description: 'node-exporter target has been down for more than 5 minutes.'

  - name: agno-agents
    rules:
      - alert: AgnoAgentsDown
        expr: up{job="agno-agents"} == 0
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: Agno Agents service is down
          description: 'Agno Agents service has not responded to Prometheus scrapes for 2 minutes.'

      - alert: AgnoAgentErrorsHigh
        expr: rate(agent_errors_total{job="agno-agents"}[5m]) > 0.1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: High error rate in Agno agents
          description: 'Agent {{ $labels.agent_name }} is experiencing high error rate: {{ $value }} errors/sec over 5 minutes.'

      - alert: AgnoAgentProcessingSlow
        expr: histogram_quantile(0.95, sum(rate(agent_processing_seconds_bucket{job="agno-agents"}[5m])) by (le, agent_name)) > 10
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: Agno agent processing is slow
          description: 'Agent {{ $labels.agent_name }} 95th percentile processing time is {{ $value }}s (threshold: 10s).'

      - alert: AgnoDependencyUnhealthy
        expr: dependency_status{job="agno-agents"} == 0
        for: 3m
        labels:
          severity: warning
        annotations:
          summary: Agno dependency is unhealthy
          description: 'Dependency {{ $labels.dependency }} has been unhealthy for 3 minutes.'

      - alert: AgnoCircuitBreakerOpen
        expr: increase(agent_errors_total{job="agno-agents", error_type="CircuitBreakerError"}[5m]) > 5
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: Agno circuit breaker is open
          description: 'Circuit breaker for {{ $labels.agent_name }} has opened due to repeated failures.'

      - alert: AgnoApiErrorsHigh
        expr: rate(api_requests_total{job="agno-agents", status=~"5.."}[5m]) > 0.5
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: High 5xx error rate in Agno Agents API
          description: 'Agno Agents API is returning 5xx responses at a rate of {{ $value }} req/s over the last 5 minutes.'
