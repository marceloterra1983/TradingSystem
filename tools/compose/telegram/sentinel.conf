# ==============================================================================
# Redis Sentinel Configuration for Telegram Stack
# ==============================================================================
# Purpose: Monitor Redis Master/Replica and perform automatic failover
# Quorum: 2 (require 2 Sentinels to agree on failover)
# ==============================================================================

# Sentinel listens on this port
port 26379

# Bind to all interfaces
bind 0.0.0.0

# Working directory
dir /tmp

# ==============================================================================
# Master Monitoring Configuration
# ==============================================================================
# sentinel monitor <master-name> <ip> <port> <quorum>
# Quorum: Number of Sentinels that must agree master is down before failover
sentinel monitor telegram-redis telegram-redis-master 6379 2

# ==============================================================================
# Failure Detection Settings
# ==============================================================================
# Time (ms) an instance should be unreachable before being considered down
sentinel down-after-milliseconds telegram-redis 5000

# How many slaves can be reconfigured simultaneously during failover
# Lower value = safer (less load) but slower failover
sentinel parallel-syncs telegram-redis 1

# Timeout (ms) for failover process
# If failover doesn't complete in this time, it's aborted
sentinel failover-timeout telegram-redis 10000

# ==============================================================================
# Notification Scripts (optional, can be configured later)
# ==============================================================================
# Script to run when any Sentinel event happens
# sentinel notification-script telegram-redis /etc/redis/notify.sh

# Script to run when failover happens (reconfig clients)
# sentinel client-reconfig-script telegram-redis /etc/redis/reconfig.sh

# ==============================================================================
# Logging
# ==============================================================================
loglevel notice
logfile ""

# ==============================================================================
# Security
# ==============================================================================
# Prevent runtime reconfiguration of scripts (security hardening)
sentinel deny-scripts-reconfig yes

# ==============================================================================
# Advanced Settings
# ==============================================================================
# Sentinel announces its IP and port to other Sentinels and clients
# Leave commented to auto-detect
# sentinel announce-ip <ip>
# sentinel announce-port 26379

