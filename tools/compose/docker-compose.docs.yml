# ============================================================================
# TradingSystem - Documentation Services Stack
# ============================================================================
# Services:
#   - DocsAPI (Port 3400) - Documentation management API (placeholder with health)
#   - DocsSpecs (Port 3101) - OpenAPI/AsyncAPI viewer
#
# Usage:
#   docker compose -f tools/compose/docker-compose.docs.yml up -d
#   docker compose -f tools/compose/docker-compose.docs.yml logs -f
#   docker compose -f tools/compose/docker-compose.docs.yml down
#
# Last Updated: 2025-10-23
# ============================================================================

name: documentation

services:
  # ============================================================================
  # DocsAPI - Documentation Management API (Placeholder with Health)
  # ============================================================================
  documentation-api:
    container_name: docs-api
    image: "${IMG_DOCS_API:-img-docs-api}:${IMG_VERSION:-latest}"
    platform: linux/amd64
    build:
      context: ../docs-api
      dockerfile: Dockerfile
    ports:
      - "${DOCS_API_PORT:-3400}:80"
    restart: unless-stopped
    env_file:
      - ../../config/docker.env
    networks:
      - tradingsystem_backend
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost/health"]
      interval: 30s
      timeout: 10s
      start_period: 10s
      retries: 3
    labels:
      - "com.tradingsystem.stack=documentation"
      - "com.tradingsystem.service=docs-api"
      - "com.tradingsystem.type=backend"
      - "com.tradingsystem.port=3400"

  # ============================================================================
  # DocsSpecs - OpenAPI & AsyncAPI Specifications Viewer
  # ============================================================================
  docs-api-viewer:
    container_name: docs-api-viewer
    image: "${IMG_DOCS_API_VIEWER:-nginx}:${IMG_DOCS_VIEWER_VERSION:-alpine}"
    platform: linux/amd64
    ports:
      - "${DOCSPECS_PORT:-3101}:80"
    environment:
      - NODE_ENV=production
      - PORT=80
    volumes:
      - ../../docs/spec:/usr/share/nginx/html:ro
    networks:
      - tradingsystem_frontend
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost/"]
      interval: 30s
      timeout: 10s
      start_period: 20s
      retries: 3
    labels:
      - "com.tradingsystem.stack=documentation"
      - "com.tradingsystem.service=docs-api-viewer"
      - "com.tradingsystem.type=frontend"
      - "com.tradingsystem.port=3101"

# ============================================================================
# Networks
# ============================================================================
networks:
  tradingsystem_backend:
    external: true
  tradingsystem_frontend:
    external: true
